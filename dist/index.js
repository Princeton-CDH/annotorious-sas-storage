(()=>{"use strict";var t={737:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});class n{constructor(t,e){this.canvasId=t,this.endpointUrl=e}get annotationPageId(){return`${this.endpointUrl}/search?uri=${this.canvasId}`}async create(t){return fetch(`${this.endpointUrl}/create`,{body:JSON.stringify(n.createV2Anno(t)),headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST"}).then((()=>this.all())).catch((()=>this.all()))}async update(t){return fetch(`${this.endpointUrl}/update`,{body:JSON.stringify(n.createV2Anno(t)),headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST"}).then((()=>this.all())).catch((()=>this.all()))}async delete(t){return fetch(`${this.endpointUrl}/destroy?uri=${encodeURIComponent(t)}`,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"DELETE"}).then((()=>this.all())).catch((()=>this.all()))}async get(t){const e=await this.all();return e?e.items.find((e=>e.id===t)):null}async all(){const t=await fetch(this.annotationPageId),e=await t.json();return this.createAnnotationPage(e)}static createV2Anno(t){let e=null;e=Array.isArray(t.body)?t.body.map((t=>this.createV2AnnoBody(t))):this.createV2AnnoBody(t.body);const n={"@id":t.id&&t.id.startsWith("http")?t.id:void 0,"@context":"http://iiif.io/api/presentation/2/context.json","@type":"oa:Annotation",motivation:"oa:commenting",on:{"@type":"oa:SpecificResource",full:t.target.source.id},resource:e};if(t.target.selector){if(Array.isArray(t.target.selector)){const e=t.target.selector.map((t=>{if(t){let e=this.createV2AnnoSelector(t);if(e)return e}}));n.on.selector={"@type":"oa:Choice",default:e[0],item:e[1]}}else{let e=this.createV2AnnoSelector(t.target.selector);e&&(n.on.selector=e)}t.target.source.partOf&&(n.on.within={"@id":t.target.source.partOf.id,"@type":"sc:Manifest"})}return n}static createV2AnnoBody(t){const e={"@type":"tagging"===t.purpose?"oa:Tag":"dctypes:Text",chars:t.value};return t.format&&(e.format=t.format),t.language&&(e.language=t.language),e}static createV2AnnoSelector(t){switch(t.type){case"SvgSelector":return{"@type":"oa:SvgSelector",value:t.value};case"FragmentSelector":return{"@type":"oa:FragmentSelector",value:t.value.replace("xywh=pixel:","xywh=")};default:return null}}createAnnotationPage(t){if(Array.isArray(t)){const e=t.map((t=>n.createV3Anno(t)));return{id:this.annotationPageId,items:e,type:"AnnotationPage"}}return t}static createV3Anno(t){let e=null;e=Array.isArray(t.resource)?t.resource.map((t=>this.createV3AnnoBody(t))):this.createV3AnnoBody(t.resource);let n=t.on;Array.isArray(n)&&([n]=n);let a={selector:n.selector?this.createV3AnnoSelector(n.selector):void 0,source:n.full};return n.within&&(a.source={id:n.full,partOf:{id:n.within["@id"],type:"Manifest"},type:"Canvas"}),{"@context":"http://www.w3.org/ns/anno.jsonld",id:t["@id"],motivation:"commenting",type:"Annotation",target:a,body:e}}static createV3AnnoBody(t){const e={type:"TextualBody",value:t.chars};return t.format&&(e.format=t.format),t.language&&(e.language=t.language),"oa:Tag"===t["@type"]&&(e.purpose="tagging"),e}static createV3AnnoSelector(t){switch(t["@type"]){case"oa:SvgSelector":return{type:"SvgSelector",value:t.value};case"oa:FragmentSelector":return{type:"FragmentSelector",conformsTo:"http://www.w3.org/TR/media-frags/",value:t.value?t.value.replace("xywh=","xywh=pixel:"):""};case"oa:Choice":return[t.default?this.createV3AnnoSelector(t.default):null,t.item?this.createV3AnnoSelector(t.item):null];default:return null}}}e.default=n},607:function(t,e,n){var a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=a(n(737)),r=new Event("annotations-loaded");e.default=(t,e)=>{let n=new o.default(e.target,e.annotationEndpoint);function a(t){"string"==typeof t.source&&(t.source={id:e.target,partOf:{id:e.manifest,type:"Manifest"},type:"Canvas"})}return n.all().then((e=>{t.setAnnotations(e.items),document.dispatchEvent(r)})),t.on("createAnnotation",(async e=>(a(e.target),n.create(e).then((()=>{document.dispatchEvent(r)})),console.log(e),t.addAnnotation(e),e))),t.on("updateAnnotation",((e,o)=>{e.id,e.id=o.id,a(e.target),n.update(e),t.addAnnotation(e)})),t.on("deleteAnnotation",(t=>{n.delete(t.id||"")})),{adapter:n}}}},e={},n=function n(a){var o=e[a];if(void 0!==o)return o.exports;var r=e[a]={exports:{}};return t[a].call(r.exports,r,r.exports,n),r.exports}(607);module.exports=n})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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R0FDWm9FLEVBQUtZLGNBQWNoRixHQUNaQSxLQUlYb0UsRUFBS2pDLEdBQ0Qsb0JBQ0EsQ0FBQ25DLEVBQXdCaUYsS0FFVGpGLEVBQVdrQixHQUN2QmxCLEVBQVdrQixHQUFLK0QsRUFBUy9ELEdBRXpCc0QsRUFBbUJ4RSxFQUFXcUMsUUFDOUJpQyxFQUFRWSxPQUFPbEYsR0FFZm9FLEVBQUtZLGNBQWNoRixNQUszQm9FLEVBQUtqQyxHQUFHLG9CQUFxQm5DLElBQ3pCc0UsRUFBUWEsT0FBT25GLEVBQVdrQixJQUFNLE9BR2QsQ0FDbEJvRCxRQUFTQSxNQzNFYmMsRUFBMkIsR0NFM0JDLEVEQ0osU0FBU0MsRUFBb0JDLEdBRTVCLElBQUlDLEVBQWVKLEVBQXlCRyxHQUM1QyxRQUFxQnRELElBQWpCdUQsRUFDSCxPQUFPQSxFQUFhQyxRQUdyQixJQUFJQyxFQUFTTixFQUF5QkcsR0FBWSxDQUdqREUsUUFBUyxJQU9WLE9BSEFFLEVBQW9CSixHQUFVSyxLQUFLRixFQUFPRCxRQUFTQyxFQUFRQSxFQUFPRCxRQUFTSCxHQUdwRUksRUFBT0QsUUNsQldILENBQW9CLEsiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9hbm5vdG9yaW91cy1zYXMtc3RvcmFnZS8uL3NyYy9TaW1wbGVBbm5vdGF0aW9uU2VydmVyVjJBZGFwdGVyLnRzIiwid2VicGFjazovL2Fubm90b3Jpb3VzLXNhcy1zdG9yYWdlLy4vc3JjL2luZGV4LnRzIiwid2VicGFjazovL2Fubm90b3Jpb3VzLXNhcy1zdG9yYWdlL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL2Fubm90b3Jpb3VzLXNhcy1zdG9yYWdlL3dlYnBhY2svc3RhcnR1cCJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiBDb252ZXJ0IGJldHdlZW4gdjIgKG9wZW4gYW5ub3RhdGlvbikgYW5kIHYzICh3M2MpIGFubm90YXRpb25zXG4gICBpbiBvcmRlciB0byBicmlkZ2UgYmV0d2VlbiBhbm5vdG9yaW91cyAodzNjKSBhbmQgc2ltcGxlIGFubm90YXRpb24gc2VydmVyICh2MikuXG5cbiAgIEFkYXB0ZWQgZnJvbSBtaXJhZG9yLWFubm90YXRpb25zIGNvZGVcbiAgIGh0dHBzOi8vZ2l0aHViLmNvbS9Qcm9qZWN0TWlyYWRvci9taXJhZG9yLWFubm90YXRpb25zL2Jsb2IvbWFzdGVyL3NyYy9TaW1wbGVBbm5vdGF0aW9uU2VydmVyVjJBZGFwdGVyLmpzXG5cbiovXG5cbmltcG9ydCB0eXBlIHsgQW5ub3RhdGlvbiBhcyBWMkFubm90YXRpb24gfSBmcm9tIFwiLi90eXBlcy9WMi9Bbm5vdGF0aW9uXCI7XG5pbXBvcnQgdHlwZSB7IEFubm90YXRpb24gYXMgVjNBbm5vdGF0aW9uIH0gZnJvbSBcIi4vdHlwZXMvVjMvQW5ub3RhdGlvblwiO1xuaW1wb3J0IHR5cGUgeyBBbm5vdGF0aW9uUGFnZSB9IGZyb20gXCIuL3R5cGVzL1YzL0Fubm90YXRpb25QYWdlXCI7XG5pbXBvcnQgdHlwZSB7IEJvZHkgYXMgVjJCb2R5IH0gZnJvbSBcIi4vdHlwZXMvVjIvQm9keVwiO1xuaW1wb3J0IHR5cGUgeyBCb2R5IGFzIFYzQm9keSB9IGZyb20gXCIuL3R5cGVzL1YzL0JvZHlcIjtcbmltcG9ydCB0eXBlIHsgU2VsZWN0b3IgYXMgVjJTZWxlY3RvciB9IGZyb20gXCIuL3R5cGVzL1YyL1NlbGVjdG9yXCI7XG5pbXBvcnQgdHlwZSB7IFNlbGVjdG9yIGFzIFYzU2VsZWN0b3IgfSBmcm9tIFwiLi90eXBlcy9WMy9TZWxlY3RvclwiO1xuaW1wb3J0IHR5cGUgeyBTb3VyY2UgfSBmcm9tIFwiLi90eXBlcy9WMy9Tb3VyY2VcIjtcbmltcG9ydCB0eXBlIHsgVGFyZ2V0IH0gZnJvbSBcIi4vdHlwZXMvVjMvVGFyZ2V0XCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFNpbXBsZUFubm90YXRpb25TZXJ2ZXJWMkFkYXB0ZXIge1xuICAgIGNhbnZhc0lkOiBzdHJpbmc7XG4gICAgZW5kcG9pbnRVcmw6IHN0cmluZztcblxuICAgIC8qKiAqL1xuICAgIGNvbnN0cnVjdG9yKGNhbnZhc0lkOiBzdHJpbmcsIGVuZHBvaW50VXJsOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5jYW52YXNJZCA9IGNhbnZhc0lkO1xuICAgICAgICB0aGlzLmVuZHBvaW50VXJsID0gZW5kcG9pbnRVcmw7XG4gICAgfVxuXG4gICAgLyoqICovXG4gICAgZ2V0IGFubm90YXRpb25QYWdlSWQoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIGAke3RoaXMuZW5kcG9pbnRVcmx9L3NlYXJjaD91cmk9JHt0aGlzLmNhbnZhc0lkfWA7XG4gICAgfVxuXG4gICAgLyoqICovXG4gICAgYXN5bmMgY3JlYXRlKGFubm90YXRpb246IFYzQW5ub3RhdGlvbikge1xuICAgICAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5lbmRwb2ludFVybH0vY3JlYXRlYCwge1xuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoXG4gICAgICAgICAgICAgICAgU2ltcGxlQW5ub3RhdGlvblNlcnZlclYyQWRhcHRlci5jcmVhdGVWMkFubm8oYW5ub3RhdGlvbilcbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgQWNjZXB0OiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICB9KVxuICAgICAgICAgICAgLnRoZW4oKCkgPT4gdGhpcy5hbGwoKSlcbiAgICAgICAgICAgIC5jYXRjaCgoKSA9PiB0aGlzLmFsbCgpKTtcbiAgICB9XG5cbiAgICAvKiogKi9cbiAgICBhc3luYyB1cGRhdGUoYW5ub3RhdGlvbjogVjNBbm5vdGF0aW9uKSB7XG4gICAgICAgIHJldHVybiBmZXRjaChgJHt0aGlzLmVuZHBvaW50VXJsfS91cGRhdGVgLCB7XG4gICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShcbiAgICAgICAgICAgICAgICBTaW1wbGVBbm5vdGF0aW9uU2VydmVyVjJBZGFwdGVyLmNyZWF0ZVYyQW5ubyhhbm5vdGF0aW9uKVxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICBBY2NlcHQ6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgIH0pXG4gICAgICAgICAgICAudGhlbigoKSA9PiB0aGlzLmFsbCgpKVxuICAgICAgICAgICAgLmNhdGNoKCgpID0+IHRoaXMuYWxsKCkpO1xuICAgIH1cblxuICAgIC8qKiAqL1xuICAgIGFzeW5jIGRlbGV0ZShhbm5vSWQ6IHN0cmluZykge1xuICAgICAgICByZXR1cm4gZmV0Y2goXG4gICAgICAgICAgICBgJHt0aGlzLmVuZHBvaW50VXJsfS9kZXN0cm95P3VyaT0ke2VuY29kZVVSSUNvbXBvbmVudChhbm5vSWQpfWAsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICAgICBBY2NlcHQ6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICAgICAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICAgICAgICAgIH1cbiAgICAgICAgKVxuICAgICAgICAgICAgLnRoZW4oKCkgPT4gdGhpcy5hbGwoKSlcbiAgICAgICAgICAgIC5jYXRjaCgoKSA9PiB0aGlzLmFsbCgpKTtcbiAgICB9XG5cbiAgICAvKiogKi9cbiAgICBhc3luYyBnZXQoYW5ub0lkOiBzdHJpbmcpIHtcbiAgICAgICAgLy8gU0FTIGRvZXMgbm90IGhhdmUgR0VUIGZvciBhIHNpbmdsZSBhbm5vdGF0aW9uXG4gICAgICAgIGNvbnN0IGFubm90YXRpb25QYWdlID0gYXdhaXQgdGhpcy5hbGwoKTtcbiAgICAgICAgaWYgKGFubm90YXRpb25QYWdlKSB7XG4gICAgICAgICAgICByZXR1cm4gYW5ub3RhdGlvblBhZ2UuaXRlbXMuZmluZChcbiAgICAgICAgICAgICAgICAoaXRlbTogVjNBbm5vdGF0aW9uKSA9PiBpdGVtLmlkID09PSBhbm5vSWRcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgLyoqIFJldHVybnMgYW4gQW5ub3RhdGlvblBhZ2Ugd2l0aCBhbGwgYW5ub3RhdGlvbnMgKi9cbiAgICBhc3luYyBhbGwoKTogUHJvbWlzZTxBbm5vdGF0aW9uUGFnZT4ge1xuICAgICAgICBjb25zdCByZXNwID0gYXdhaXQgZmV0Y2godGhpcy5hbm5vdGF0aW9uUGFnZUlkKTtcbiAgICAgICAgY29uc3QgYW5ub3MgPSBhd2FpdCByZXNwLmpzb24oKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlQW5ub3RhdGlvblBhZ2UoYW5ub3MpO1xuICAgIH1cblxuICAgIC8qKiBDcmVhdGVzIGEgVjIgYW5ub3RhdGlvbiBmcm9tIGEgVjMgYW5ub3RhdGlvbiAqL1xuICAgIHN0YXRpYyBjcmVhdGVWMkFubm8odjNhbm5vOiBWM0Fubm90YXRpb24pOiBWMkFubm90YXRpb24ge1xuICAgICAgICBsZXQgcmVzb3VyY2UgPSBudWxsO1xuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2M2Fubm8uYm9keSkpIHtcbiAgICAgICAgICAgIHJlc291cmNlID0gdjNhbm5vLmJvZHkubWFwKChiKSA9PiB0aGlzLmNyZWF0ZVYyQW5ub0JvZHkoYikpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVzb3VyY2UgPSB0aGlzLmNyZWF0ZVYyQW5ub0JvZHkodjNhbm5vLmJvZHkpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHYyYW5ubzogVjJBbm5vdGF0aW9uID0ge1xuICAgICAgICAgICAgLy8gY29weSBpZCBpZiBpdCBpcyBTQVMtZ2VuZXJhdGVkXG4gICAgICAgICAgICAvLyBUT0RPOiBXaGF0IGlkIHRvIHVzZSBpZiBpdCBpcyBub3Q/XG4gICAgICAgICAgICBcIkBpZFwiOiB2M2Fubm8uaWQgJiYgdjNhbm5vLmlkLnN0YXJ0c1dpdGgoXCJodHRwXCIpID8gdjNhbm5vLmlkIDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgXCJAY29udGV4dFwiOiBcImh0dHA6Ly9paWlmLmlvL2FwaS9wcmVzZW50YXRpb24vMi9jb250ZXh0Lmpzb25cIixcbiAgICAgICAgICAgIFwiQHR5cGVcIjogXCJvYTpBbm5vdGF0aW9uXCIsXG4gICAgICAgICAgICBtb3RpdmF0aW9uOiBcIm9hOmNvbW1lbnRpbmdcIiwgLy8gVE9ETzogdXNlIHYzYW5uby5tb3RpdmF0aW9uXG4gICAgICAgICAgICBvbjoge1xuICAgICAgICAgICAgICAgIFwiQHR5cGVcIjogXCJvYTpTcGVjaWZpY1Jlc291cmNlXCIsXG4gICAgICAgICAgICAgICAgZnVsbDogKHYzYW5uby50YXJnZXQuc291cmNlIGFzIFNvdXJjZSkuaWQsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVzb3VyY2UsXG4gICAgICAgIH07XG4gICAgICAgIGlmICh2M2Fubm8udGFyZ2V0LnNlbGVjdG9yKSB7XG4gICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2M2Fubm8udGFyZ2V0LnNlbGVjdG9yKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdG9ycyA9IHYzYW5uby50YXJnZXQuc2VsZWN0b3IubWFwKChzKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgdjJTZWxlY3RvciA9IHRoaXMuY3JlYXRlVjJBbm5vU2VsZWN0b3Iocyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodjJTZWxlY3RvcikgcmV0dXJuIHYyU2VsZWN0b3I7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAvLyBjcmVhdGUgY2hvaWNlLCBhc3N1bWluZyB0d28gZWxlbWVudHMgYW5kIDAgaXMgZGVmYXVsdFxuICAgICAgICAgICAgICAgIHYyYW5uby5vbi5zZWxlY3RvciA9IHtcbiAgICAgICAgICAgICAgICAgICAgXCJAdHlwZVwiOiBcIm9hOkNob2ljZVwiLFxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiBzZWxlY3RvcnNbMF0sXG4gICAgICAgICAgICAgICAgICAgIGl0ZW06IHNlbGVjdG9yc1sxXSxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBsZXQgdjJTZWxlY3RvciA9IHRoaXMuY3JlYXRlVjJBbm5vU2VsZWN0b3IoXG4gICAgICAgICAgICAgICAgICAgIHYzYW5uby50YXJnZXQuc2VsZWN0b3JcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIGlmICh2MlNlbGVjdG9yKSB2MmFubm8ub24uc2VsZWN0b3IgPSB2MlNlbGVjdG9yO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCh2M2Fubm8udGFyZ2V0LnNvdXJjZSBhcyBTb3VyY2UpLnBhcnRPZikge1xuICAgICAgICAgICAgICAgIHYyYW5uby5vbi53aXRoaW4gPSB7XG4gICAgICAgICAgICAgICAgICAgIFwiQGlkXCI6ICh2M2Fubm8udGFyZ2V0LnNvdXJjZSBhcyBTb3VyY2UpLnBhcnRPZi5pZCxcbiAgICAgICAgICAgICAgICAgICAgXCJAdHlwZVwiOiBcInNjOk1hbmlmZXN0XCIsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdjJhbm5vO1xuICAgIH1cblxuICAgIC8qKiAqL1xuICAgIHN0YXRpYyBjcmVhdGVWMkFubm9Cb2R5KHYzYm9keTogVjNCb2R5KSB7XG4gICAgICAgIGNvbnN0IHYyYm9keTogVjJCb2R5ID0ge1xuICAgICAgICAgICAgXCJAdHlwZVwiOiB2M2JvZHkucHVycG9zZSA9PT0gXCJ0YWdnaW5nXCIgPyBcIm9hOlRhZ1wiIDogXCJkY3R5cGVzOlRleHRcIixcbiAgICAgICAgICAgIGNoYXJzOiB2M2JvZHkudmFsdWUsXG4gICAgICAgIH07XG4gICAgICAgIGlmICh2M2JvZHkuZm9ybWF0KSB7XG4gICAgICAgICAgICB2MmJvZHkuZm9ybWF0ID0gdjNib2R5LmZvcm1hdDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodjNib2R5Lmxhbmd1YWdlKSB7XG4gICAgICAgICAgICB2MmJvZHkubGFuZ3VhZ2UgPSB2M2JvZHkubGFuZ3VhZ2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHYyYm9keTtcbiAgICB9XG5cbiAgICAvKiogKi9cbiAgICBzdGF0aWMgY3JlYXRlVjJBbm5vU2VsZWN0b3IodjNzZWxlY3RvcjogVjNTZWxlY3Rvcik6IFYyU2VsZWN0b3IgfCBudWxsIHtcbiAgICAgICAgc3dpdGNoICh2M3NlbGVjdG9yLnR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgXCJTdmdTZWxlY3RvclwiOlxuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIFwiQHR5cGVcIjogXCJvYTpTdmdTZWxlY3RvclwiLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdjNzZWxlY3Rvci52YWx1ZSxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgY2FzZSBcIkZyYWdtZW50U2VsZWN0b3JcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBcIkB0eXBlXCI6IFwib2E6RnJhZ21lbnRTZWxlY3RvclwiLFxuICAgICAgICAgICAgICAgICAgICAvLyBTQVMgdXNlcyBsb2NhdGlvbiBpbiB4eXdoPXgseSx3LGggZm9ybWF0OyBhbm5vdG9yaW91cyB1c2VzIHBpeGVsOngseSx3LGhcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHYzc2VsZWN0b3IudmFsdWUucmVwbGFjZShcInh5d2g9cGl4ZWw6XCIsIFwieHl3aD1cIiksXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKiogQ3JlYXRlcyBhbiBBbm5vdGF0aW9uUGFnZSBmcm9tIGEgbGlzdCBvZiBWMiBhbm5vdGF0aW9ucyAqL1xuICAgIGNyZWF0ZUFubm90YXRpb25QYWdlKHYyYW5ub3M6IFYyQW5ub3RhdGlvbltdKTogQW5ub3RhdGlvblBhZ2Uge1xuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2MmFubm9zKSkge1xuICAgICAgICAgICAgY29uc3QgdjNhbm5vcyA9IHYyYW5ub3MubWFwKChhKSA9PlxuICAgICAgICAgICAgICAgIFNpbXBsZUFubm90YXRpb25TZXJ2ZXJWMkFkYXB0ZXIuY3JlYXRlVjNBbm5vKGEpXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBpZDogdGhpcy5hbm5vdGF0aW9uUGFnZUlkLFxuICAgICAgICAgICAgICAgIGl0ZW1zOiB2M2Fubm9zLFxuICAgICAgICAgICAgICAgIHR5cGU6IFwiQW5ub3RhdGlvblBhZ2VcIixcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHYyYW5ub3M7XG4gICAgfVxuXG4gICAgLyoqIENyZWF0ZXMgYSBWMyBhbm5vdGF0aW9uIGZyb20gYSBWMiBhbm5vdGF0aW9uICovXG4gICAgc3RhdGljIGNyZWF0ZVYzQW5ubyh2MmFubm86IFYyQW5ub3RhdGlvbik6IFYzQW5ub3RhdGlvbiB7XG4gICAgICAgIGxldCBib2R5ID0gbnVsbDtcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodjJhbm5vLnJlc291cmNlKSkge1xuICAgICAgICAgICAgYm9keSA9IHYyYW5uby5yZXNvdXJjZS5tYXAoKGI6IFYyQm9keSkgPT4gdGhpcy5jcmVhdGVWM0Fubm9Cb2R5KGIpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGJvZHkgPSB0aGlzLmNyZWF0ZVYzQW5ub0JvZHkodjJhbm5vLnJlc291cmNlKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgdjJ0YXJnZXQgPSB2MmFubm8ub247XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KHYydGFyZ2V0KSkge1xuICAgICAgICAgICAgW3YydGFyZ2V0XSA9IHYydGFyZ2V0O1xuICAgICAgICB9XG4gICAgICAgIGxldCB0YXJnZXQ6IFRhcmdldCA9IHtcbiAgICAgICAgICAgIHNlbGVjdG9yOiB2MnRhcmdldC5zZWxlY3RvciA/IHRoaXMuY3JlYXRlVjNBbm5vU2VsZWN0b3IodjJ0YXJnZXQuc2VsZWN0b3IpIDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgc291cmNlOiB2MnRhcmdldC5mdWxsLFxuICAgICAgICB9O1xuICAgICAgICBpZiAodjJ0YXJnZXQud2l0aGluKSB7XG4gICAgICAgICAgICB0YXJnZXQuc291cmNlID0ge1xuICAgICAgICAgICAgICAgIGlkOiB2MnRhcmdldC5mdWxsLFxuICAgICAgICAgICAgICAgIHBhcnRPZjoge1xuICAgICAgICAgICAgICAgICAgICBpZDogdjJ0YXJnZXQud2l0aGluW1wiQGlkXCJdLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIk1hbmlmZXN0XCIsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB0eXBlOiBcIkNhbnZhc1wiLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgXCJAY29udGV4dFwiOiBcImh0dHA6Ly93d3cudzMub3JnL25zL2Fubm8uanNvbmxkXCIsXG4gICAgICAgICAgICBpZDogdjJhbm5vW1wiQGlkXCJdLFxuICAgICAgICAgICAgbW90aXZhdGlvbjogXCJjb21tZW50aW5nXCIsXG4gICAgICAgICAgICB0eXBlOiBcIkFubm90YXRpb25cIixcbiAgICAgICAgICAgIHRhcmdldCxcbiAgICAgICAgICAgIGJvZHksXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgLyoqICovXG4gICAgc3RhdGljIGNyZWF0ZVYzQW5ub0JvZHkodjJib2R5OiBWMkJvZHkpOiBWM0JvZHkge1xuICAgICAgICBjb25zdCB2M2JvZHk6IFYzQm9keSA9IHtcbiAgICAgICAgICAgIHR5cGU6IFwiVGV4dHVhbEJvZHlcIixcbiAgICAgICAgICAgIHZhbHVlOiB2MmJvZHkuY2hhcnMsXG4gICAgICAgIH07XG4gICAgICAgIGlmICh2MmJvZHkuZm9ybWF0KSB7XG4gICAgICAgICAgICB2M2JvZHkuZm9ybWF0ID0gdjJib2R5LmZvcm1hdDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodjJib2R5Lmxhbmd1YWdlKSB7XG4gICAgICAgICAgICB2M2JvZHkubGFuZ3VhZ2UgPSB2MmJvZHkubGFuZ3VhZ2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHYyYm9keVtcIkB0eXBlXCJdID09PSBcIm9hOlRhZ1wiKSB7XG4gICAgICAgICAgICB2M2JvZHkucHVycG9zZSA9IFwidGFnZ2luZ1wiO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB2M2JvZHk7XG4gICAgfVxuXG4gICAgLyoqICovXG4gICAgc3RhdGljIGNyZWF0ZVYzQW5ub1NlbGVjdG9yKHYyc2VsZWN0b3I6IFYyU2VsZWN0b3IpOiBhbnkge1xuICAgICAgICAvLyBUT0RPOiB0eXBlLXNhZmUgdGhpcyByZXR1cm4gdmFsdWVcbiAgICAgICAgc3dpdGNoICh2MnNlbGVjdG9yW1wiQHR5cGVcIl0pIHtcbiAgICAgICAgICAgIGNhc2UgXCJvYTpTdmdTZWxlY3RvclwiOlxuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiU3ZnU2VsZWN0b3JcIixcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHYyc2VsZWN0b3IudmFsdWUsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNhc2UgXCJvYTpGcmFnbWVudFNlbGVjdG9yXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJGcmFnbWVudFNlbGVjdG9yXCIsXG4gICAgICAgICAgICAgICAgICAgIGNvbmZvcm1zVG86IFwiaHR0cDovL3d3dy53My5vcmcvVFIvbWVkaWEtZnJhZ3MvXCIsXG4gICAgICAgICAgICAgICAgICAgIC8vIFNBUyByZXR1cm5zIGxvY2F0aW9uIGluIHh5d2g9eCx5LHcsaCBmb3JtYXQ7IGFubm90b3Jpb3VzIHVzZXMgcGl4ZWw6eCx5LHcsaFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdjJzZWxlY3Rvci52YWx1ZSA/IHYyc2VsZWN0b3IudmFsdWUucmVwbGFjZShcInh5d2g9XCIsIFwieHl3aD1waXhlbDpcIikgOiBcIlwiLFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICBjYXNlIFwib2E6Q2hvaWNlXCI6XG4gICAgICAgICAgICAgICAgLyogY3JlYXRlIGFsdGVybmF0ZSBzZWxlY3RvcnMgKi9cbiAgICAgICAgICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgICAgICAgICB2MnNlbGVjdG9yLmRlZmF1bHRcbiAgICAgICAgICAgICAgICAgICAgICAgID8gdGhpcy5jcmVhdGVWM0Fubm9TZWxlY3Rvcih2MnNlbGVjdG9yLmRlZmF1bHQpXG4gICAgICAgICAgICAgICAgICAgICAgICA6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIHYyc2VsZWN0b3IuaXRlbVxuICAgICAgICAgICAgICAgICAgICAgICAgPyB0aGlzLmNyZWF0ZVYzQW5ub1NlbGVjdG9yKHYyc2VsZWN0b3IuaXRlbSlcbiAgICAgICAgICAgICAgICAgICAgICAgIDogbnVsbCxcbiAgICAgICAgICAgICAgICBdO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbn1cbiIsIi8vIGFubm90b3Jpb3VzIHBsdWdpbiB0byB1c2Ugc2ltcGxlIGFubm90YXRpb24gc2VydmVyIGFzIGEgc3RvcmFnZVxuXG5pbXBvcnQgU2ltcGxlQW5ub3RhdGlvblNlcnZlclYyQWRhcHRlciBmcm9tIFwiLi9TaW1wbGVBbm5vdGF0aW9uU2VydmVyVjJBZGFwdGVyXCI7XG5pbXBvcnQgdHlwZSB7IEFubm90YXRpb24gfSBmcm9tIFwiLi90eXBlcy9WMy9Bbm5vdGF0aW9uXCI7XG5pbXBvcnQgdHlwZSB7IEFubm90YXRpb25QYWdlIH0gZnJvbSBcIi4vdHlwZXMvVjMvQW5ub3RhdGlvblBhZ2VcIjtcbmltcG9ydCB0eXBlIHsgU2V0dGluZ3MgfSBmcm9tIFwiLi90eXBlcy9TZXR0aW5nc1wiO1xuaW1wb3J0IHR5cGUgeyBUYXJnZXQgfSBmcm9tIFwiLi90eXBlcy9WMy9UYXJnZXRcIjtcblxuLy8gZGVmaW5lIGEgY3VzdG9tIGV2ZW50IHRvIGluZGljYXRlIHRoYXQgYW5ub3RhdGlvbnMgaGF2ZSBiZWVuIGxvYWRlZFxuY29uc3QgQW5ub0xvYWRFdmVudCA9IG5ldyBFdmVudChcImFubm90YXRpb25zLWxvYWRlZFwiKTtcblxuY29uc3QgQW5ub3RhdGlvblNlcnZlclN0b3JhZ2UgPSAoYW5ubzogYW55LCBzZXR0aW5nczogU2V0dGluZ3MpID0+IHtcbiAgICBsZXQgYWRhcHRlciA9IG5ldyBTaW1wbGVBbm5vdGF0aW9uU2VydmVyVjJBZGFwdGVyKFxuICAgICAgICBzZXR0aW5ncy50YXJnZXQsIC8vIHNob3VsZCBiZSBjYW52YXMgaWRcbiAgICAgICAgc2V0dGluZ3MuYW5ub3RhdGlvbkVuZHBvaW50XG4gICAgKTtcblxuICAgIC8vIGxvYWQgYW5kIGRpc3BsYXkgYW5ub3RhdGlvbnMgZnJvbSBzZXJ2ZXJcbiAgICBhZGFwdGVyLmFsbCgpLnRoZW4oKGFubm90YXRpb25QYWdlOiBBbm5vdGF0aW9uUGFnZSkgPT4ge1xuICAgICAgICBhbm5vLnNldEFubm90YXRpb25zKGFubm90YXRpb25QYWdlLml0ZW1zKTtcbiAgICAgICAgZG9jdW1lbnQuZGlzcGF0Y2hFdmVudChBbm5vTG9hZEV2ZW50KTtcbiAgICB9KTtcblxuICAgIGZ1bmN0aW9uIGFkanVzdFRhcmdldFNvdXJjZSh0YXJnZXQ6IFRhcmdldCkge1xuICAgICAgICAvLyBhbm5vdG9yaW91cyBzZXRzIHRoZSB0YXJnZXQgc291cmNlIGFzIGEgc3RyaW5nIGlkO1xuICAgICAgICAvLyB3ZSBuZWVkIHRvIHN0cnVjdHVyZSBpdCB0byBhZGQgY2FudmFzL21hbmlmZXN0IGluZm9cbiAgICAgICAgaWYgKHR5cGVvZiB0YXJnZXQuc291cmNlID09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgIC8vIGFkZCBtYW5pZmVzdCBpZCB0byBhbm5vdGF0aW9uXG4gICAgICAgICAgICB0YXJnZXQuc291cmNlID0ge1xuICAgICAgICAgICAgICAgIC8vIHVzZSB0aGUgY29uZmlndXJlZCB0YXJnZXQgKHNob3VsZCBiZSBjYW52YXMgaWQpXG4gICAgICAgICAgICAgICAgaWQ6IHNldHRpbmdzLnRhcmdldCxcbiAgICAgICAgICAgICAgICAvLyBsaW5rIHRvIGNvbnRhaW5pbmcgbWFuaWZlc3RcbiAgICAgICAgICAgICAgICBwYXJ0T2Y6IHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IHNldHRpbmdzLm1hbmlmZXN0LFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIk1hbmlmZXN0XCIsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB0eXBlOiBcIkNhbnZhc1wiLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIGNyZWF0ZSBhIG5ldyBhbm5vdGF0aW9uXG4gICAgYW5uby5vbihcImNyZWF0ZUFubm90YXRpb25cIiwgYXN5bmMgKGFubm90YXRpb246IEFubm90YXRpb24pID0+IHtcbiAgICAgICAgYWRqdXN0VGFyZ2V0U291cmNlKGFubm90YXRpb24udGFyZ2V0KTtcbiAgICAgICAgYWRhcHRlci5jcmVhdGUoYW5ub3RhdGlvbikudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAvLyBieSBkZWZhdWx0LCBzdG9yYWdlIHJlbG9hZHMgYWxsIGFubm90YXRpb25zIGZvciB0aGlzIHBhZ2U7XG4gICAgICAgICAgICAvLyBzaWduYWwgdGhhdCBhbm5vdGF0aW9ucyBoYXZlIGJlZW4gbG9hZGVkXG4gICAgICAgICAgICBkb2N1bWVudC5kaXNwYXRjaEV2ZW50KEFubm9Mb2FkRXZlbnQpO1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gaG93IHRvIHVwZGF0ZSBpZCBmb3IgYW5ub3RvcmlvdXM/XG4gICAgICAgIGNvbnNvbGUubG9nKGFubm90YXRpb24pO1xuICAgICAgICBhbm5vLmFkZEFubm90YXRpb24oYW5ub3RhdGlvbik7XG4gICAgICAgIHJldHVybiBhbm5vdGF0aW9uO1xuICAgIH0pO1xuXG4gICAgLy8gdXBkYXRlIGFuIGFubm90YXRpb25cbiAgICBhbm5vLm9uKFxuICAgICAgICBcInVwZGF0ZUFubm90YXRpb25cIixcbiAgICAgICAgKGFubm90YXRpb246IEFubm90YXRpb24sIHByZXZpb3VzOiBBbm5vdGF0aW9uKSA9PiB7XG4gICAgICAgICAgICAvLyBUaGUgcG9zdGVkIGFubm90YXRpb24gc2hvdWxkIGhhdmUgYW4gQGlkIHdoaWNoIGV4aXN0cyBpbiB0aGUgc3RvcmVcbiAgICAgICAgICAgIGxldCBuZXdJZCA9IGFubm90YXRpb24uaWQ7IC8vIGRvIHdlIG5lZWQgdG8gZG8gYW55dGhpbmcgd2l0aCB0aGlzP1xuICAgICAgICAgICAgYW5ub3RhdGlvbi5pZCA9IHByZXZpb3VzLmlkO1xuICAgICAgICAgICAgLy8gdGFyZ2V0IG5lZWRzIHRvIGJlIHVwZGF0ZWQgaWYgdGhlIGltYWdlIHNlbGVjdGlvbiBoYXMgY2hhbmdlZFxuICAgICAgICAgICAgYWRqdXN0VGFyZ2V0U291cmNlKGFubm90YXRpb24udGFyZ2V0KTtcbiAgICAgICAgICAgIGFkYXB0ZXIudXBkYXRlKGFubm90YXRpb24pO1xuICAgICAgICAgICAgLy8gYWRkIHRoZSBhbm5vdGF0aW9uIHRvIGFubm90b3Jpb3VzIGFnYWluIHRvIG1ha2Ugc3VyZSB0aGUgZGlzcGxheSBpcyB1cCB0byBkYXRlXG4gICAgICAgICAgICBhbm5vLmFkZEFubm90YXRpb24oYW5ub3RhdGlvbik7XG4gICAgICAgIH1cbiAgICApO1xuXG4gICAgLy8gZGVsZXRlIGFuIGFubm90YXRpb25cbiAgICBhbm5vLm9uKFwiZGVsZXRlQW5ub3RhdGlvblwiLCAoYW5ub3RhdGlvbjogQW5ub3RhdGlvbikgPT4ge1xuICAgICAgICBhZGFwdGVyLmRlbGV0ZShhbm5vdGF0aW9uLmlkIHx8IFwiXCIpO1xuICAgIH0pO1xuXG4gICAgY29uc3Qgc3RvcmFnZVBsdWdpbiA9IHtcbiAgICAgICAgYWRhcHRlcjogYWRhcHRlcixcbiAgICB9O1xuXG4gICAgcmV0dXJuIHN0b3JhZ2VQbHVnaW47XG59O1xuXG5leHBvcnQgZGVmYXVsdCBBbm5vdGF0aW9uU2VydmVyU3RvcmFnZTtcbiIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4iLCIvLyBzdGFydHVwXG4vLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbi8vIFRoaXMgZW50cnkgbW9kdWxlIGlzIHJlZmVyZW5jZWQgYnkgb3RoZXIgbW9kdWxlcyBzbyBpdCBjYW4ndCBiZSBpbmxpbmVkXG52YXIgX193ZWJwYWNrX2V4cG9ydHNfXyA9IF9fd2VicGFja19yZXF1aXJlX18oNjA3KTtcbiJdLCJuYW1lcyI6WyJTaW1wbGVBbm5vdGF0aW9uU2VydmVyVjJBZGFwdGVyIiwiY29uc3RydWN0b3IiLCJjYW52YXNJZCIsImVuZHBvaW50VXJsIiwidGhpcyIsImFubm90YXRpb25QYWdlSWQiLCJhc3luYyIsImFubm90YXRpb24iLCJmZXRjaCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiY3JlYXRlVjJBbm5vIiwiaGVhZGVycyIsIkFjY2VwdCIsIm1ldGhvZCIsInRoZW4iLCJhbGwiLCJjYXRjaCIsImFubm9JZCIsImVuY29kZVVSSUNvbXBvbmVudCIsImFubm90YXRpb25QYWdlIiwiaXRlbXMiLCJmaW5kIiwiaXRlbSIsImlkIiwicmVzcCIsImFubm9zIiwianNvbiIsImNyZWF0ZUFubm90YXRpb25QYWdlIiwic3RhdGljIiwidjNhbm5vIiwicmVzb3VyY2UiLCJBcnJheSIsImlzQXJyYXkiLCJtYXAiLCJiIiwiY3JlYXRlVjJBbm5vQm9keSIsInYyYW5ubyIsInN0YXJ0c1dpdGgiLCJ1bmRlZmluZWQiLCJtb3RpdmF0aW9uIiwib24iLCJmdWxsIiwidGFyZ2V0Iiwic291cmNlIiwic2VsZWN0b3IiLCJzZWxlY3RvcnMiLCJzIiwidjJTZWxlY3RvciIsImNyZWF0ZVYyQW5ub1NlbGVjdG9yIiwiZGVmYXVsdCIsInBhcnRPZiIsIndpdGhpbiIsInYzYm9keSIsInYyYm9keSIsInB1cnBvc2UiLCJjaGFycyIsInZhbHVlIiwiZm9ybWF0IiwibGFuZ3VhZ2UiLCJ2M3NlbGVjdG9yIiwidHlwZSIsInJlcGxhY2UiLCJ2MmFubm9zIiwidjNhbm5vcyIsImEiLCJjcmVhdGVWM0Fubm8iLCJjcmVhdGVWM0Fubm9Cb2R5IiwidjJ0YXJnZXQiLCJjcmVhdGVWM0Fubm9TZWxlY3RvciIsInYyc2VsZWN0b3IiLCJjb25mb3Jtc1RvIiwiQW5ub0xvYWRFdmVudCIsIkV2ZW50IiwiYW5ubyIsInNldHRpbmdzIiwiYWRhcHRlciIsImFubm90YXRpb25FbmRwb2ludCIsImFkanVzdFRhcmdldFNvdXJjZSIsIm1hbmlmZXN0Iiwic2V0QW5ub3RhdGlvbnMiLCJkb2N1bWVudCIsImRpc3BhdGNoRXZlbnQiLCJjcmVhdGUiLCJjb25zb2xlIiwibG9nIiwiYWRkQW5ub3RhdGlvbiIsInByZXZpb3VzIiwidXBkYXRlIiwiZGVsZXRlIiwiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX2V4cG9ydHNfXyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImNhY2hlZE1vZHVsZSIsImV4cG9ydHMiLCJtb2R1bGUiLCJfX3dlYnBhY2tfbW9kdWxlc19fIiwiY2FsbCJdLCJzb3VyY2VSb290IjoiIn0=