(()=>{"use strict";var t={737:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});class n{constructor(t,e){this.canvasId=t,this.endpointUrl=e}get annotationPageId(){return`${this.endpointUrl}/search?uri=${this.canvasId}`}async create(t){return fetch(`${this.endpointUrl}/create`,{body:JSON.stringify(n.createV2Anno(t)),headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST"}).then((()=>this.all())).catch((()=>this.all()))}async update(t){return fetch(`${this.endpointUrl}/update`,{body:JSON.stringify(n.createV2Anno(t)),headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST"}).then((()=>this.all())).catch((()=>this.all()))}async delete(t){return fetch(`${this.endpointUrl}/destroy?uri=${encodeURIComponent(t)}`,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"DELETE"}).then((()=>this.all())).catch((()=>this.all()))}async get(t){const e=await this.all();return e?e.items.find((e=>e.id===t)):null}async all(){const t=await fetch(this.annotationPageId),e=await t.json();return this.createAnnotationPage(e)}static createV2Anno(t){let e=null;e=Array.isArray(t.body)?t.body.map((t=>this.createV2AnnoBody(t))):this.createV2AnnoBody(t.body);const n={"@id":t.id&&t.id.startsWith("http")?t.id:void 0,"@context":"http://iiif.io/api/presentation/2/context.json","@type":"oa:Annotation",motivation:"oa:commenting",on:{"@type":"oa:SpecificResource",full:t.target.source.id},resource:e};if(t.target.selector){if(Array.isArray(t.target.selector)){const e=t.target.selector.map((t=>{if(t){let e=this.createV2AnnoSelector(t);if(e)return e}}));n.on.selector={"@type":"oa:Choice",default:e[0],item:e[1]}}else{let e=this.createV2AnnoSelector(t.target.selector);e&&(n.on.selector=e)}t.target.source.partOf&&(n.on.within={"@id":t.target.source.partOf.id,"@type":"sc:Manifest"})}return n}static createV2AnnoBody(t){const e={"@type":"tagging"===t.purpose?"oa:Tag":"dctypes:Text",chars:t.value};return t.format&&(e.format=t.format),t.language&&(e.language=t.language),e}static createV2AnnoSelector(t){switch(t.type){case"SvgSelector":return{"@type":"oa:SvgSelector",value:t.value};case"FragmentSelector":return{"@type":"oa:FragmentSelector",value:t.value.replace("xywh=pixel:","xywh=")};default:return null}}createAnnotationPage(t){if(Array.isArray(t)){const e=t.map((t=>n.createV3Anno(t)));return{id:this.annotationPageId,items:e,type:"AnnotationPage"}}return t}static createV3Anno(t){let e=null;e=Array.isArray(t.resource)?t.resource.map((t=>this.createV3AnnoBody(t))):this.createV3AnnoBody(t.resource);let n=t.on;Array.isArray(n)&&([n]=n);let a={selector:n.selector?this.createV3AnnoSelector(n.selector):void 0,source:n.full};return n.within&&(a.source={id:n.full,partOf:{id:n.within["@id"],type:"Manifest"},type:"Canvas"}),{"@context":"http://www.w3.org/ns/anno.jsonld",id:t["@id"],motivation:"commenting",type:"Annotation",target:a,body:e}}static createV3AnnoBody(t){const e={type:"TextualBody",value:t.chars};return t.format&&(e.format=t.format),t.language&&(e.language=t.language),"oa:Tag"===t["@type"]&&(e.purpose="tagging"),e}static createV3AnnoSelector(t){switch(t["@type"]){case"oa:SvgSelector":return{type:"SvgSelector",value:t.value};case"oa:FragmentSelector":return{type:"FragmentSelector",conformsTo:"http://www.w3.org/TR/media-frags/",value:t.value?t.value.replace("xywh=","xywh=pixel:"):""};case"oa:Choice":return[t.default?this.createV3AnnoSelector(t.default):null,t.item?this.createV3AnnoSelector(t.item):null];default:return null}}}e.default=n},607:function(t,e,n){var a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=a(n(737)),r=new Event("annotations-loaded");e.default=(t,e)=>{let n=new o.default(e.target,e.annotationEndpoint);function a(t){"string"==typeof t.source&&(t.source={id:e.target,partOf:{id:e.manifest,type:"Manifest"},type:"Canvas"})}return n.all().then((e=>{t.setAnnotations(e.items),document.dispatchEvent(r)})),t.on("createAnnotation",(async e=>(a(e.target),n.create(e).then((()=>{document.dispatchEvent(r)})),console.log(e),t.addAnnotation(e),e))),t.on("updateAnnotation",((e,o)=>{e.id,e.id=o.id,a(e.target),n.update(e),t.addAnnotation(e)})),t.on("deleteAnnotation",(t=>{n.delete(t.id)})),{adapter:n}}}},e={},n=function n(a){var o=e[a];if(void 0!==o)return o.exports;var r=e[a]={exports:{}};return t[a].call(r.exports,r,r.exports,n),r.exports}(607);module.exports=n})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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R0FDWm9FLEVBQUtZLGNBQWNoRixHQUNaQSxLQUlYb0UsRUFBS2pDLEdBQ0Qsb0JBQ0EsQ0FBQ25DLEVBQXdCaUYsS0FFVGpGLEVBQVdrQixHQUN2QmxCLEVBQVdrQixHQUFLK0QsRUFBUy9ELEdBRXpCc0QsRUFBbUJ4RSxFQUFXcUMsUUFDOUJpQyxFQUFRWSxPQUFPbEYsR0FFZm9FLEVBQUtZLGNBQWNoRixNQUszQm9FLEVBQUtqQyxHQUFHLG9CQUFxQm5DLElBQ3pCc0UsRUFBUWEsT0FBT25GLEVBQVdrQixPQUdSLENBQ2xCb0QsUUFBU0EsTUMzRWJjLEVBQTJCLEdDRTNCQyxFRENKLFNBQVNDLEVBQW9CQyxHQUU1QixJQUFJQyxFQUFlSixFQUF5QkcsR0FDNUMsUUFBcUJ0RCxJQUFqQnVELEVBQ0gsT0FBT0EsRUFBYUMsUUFHckIsSUFBSUMsRUFBU04sRUFBeUJHLEdBQVksQ0FHakRFLFFBQVMsSUFPVixPQUhBRSxFQUFvQkosR0FBVUssS0FBS0YsRUFBT0QsUUFBU0MsRUFBUUEsRUFBT0QsUUFBU0gsR0FHcEVJLEVBQU9ELFFDbEJXSCxDQUFvQixLIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYW5ub3RvcmlvdXMtc2FzLXN0b3JhZ2UvLi9zcmMvU2ltcGxlQW5ub3RhdGlvblNlcnZlclYyQWRhcHRlci50cyIsIndlYnBhY2s6Ly9hbm5vdG9yaW91cy1zYXMtc3RvcmFnZS8uL3NyYy9pbmRleC50cyIsIndlYnBhY2s6Ly9hbm5vdG9yaW91cy1zYXMtc3RvcmFnZS93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9hbm5vdG9yaW91cy1zYXMtc3RvcmFnZS93ZWJwYWNrL3N0YXJ0dXAiXSwic291cmNlc0NvbnRlbnQiOlsiLyogQ29udmVydCBiZXR3ZWVuIHYyIChvcGVuIGFubm90YXRpb24pIGFuZCB2MyAodzNjKSBhbm5vdGF0aW9uc1xuICAgaW4gb3JkZXIgdG8gYnJpZGdlIGJldHdlZW4gYW5ub3RvcmlvdXMgKHczYykgYW5kIHNpbXBsZSBhbm5vdGF0aW9uIHNlcnZlciAodjIpLlxuXG4gICBBZGFwdGVkIGZyb20gbWlyYWRvci1hbm5vdGF0aW9ucyBjb2RlXG4gICBodHRwczovL2dpdGh1Yi5jb20vUHJvamVjdE1pcmFkb3IvbWlyYWRvci1hbm5vdGF0aW9ucy9ibG9iL21hc3Rlci9zcmMvU2ltcGxlQW5ub3RhdGlvblNlcnZlclYyQWRhcHRlci5qc1xuXG4qL1xuXG5pbXBvcnQgdHlwZSB7IEFubm90YXRpb24gYXMgVjJBbm5vdGF0aW9uIH0gZnJvbSBcIi4vdHlwZXMvVjIvQW5ub3RhdGlvblwiO1xuaW1wb3J0IHR5cGUgeyBBbm5vdGF0aW9uIGFzIFYzQW5ub3RhdGlvbiB9IGZyb20gXCIuL3R5cGVzL1YzL0Fubm90YXRpb25cIjtcbmltcG9ydCB0eXBlIHsgQW5ub3RhdGlvblBhZ2UgfSBmcm9tIFwiLi90eXBlcy9WMy9Bbm5vdGF0aW9uUGFnZVwiO1xuaW1wb3J0IHR5cGUgeyBCb2R5IGFzIFYyQm9keSB9IGZyb20gXCIuL3R5cGVzL1YyL0JvZHlcIjtcbmltcG9ydCB0eXBlIHsgQm9keSBhcyBWM0JvZHkgfSBmcm9tIFwiLi90eXBlcy9WMy9Cb2R5XCI7XG5pbXBvcnQgdHlwZSB7IFNlbGVjdG9yIGFzIFYyU2VsZWN0b3IgfSBmcm9tIFwiLi90eXBlcy9WMi9TZWxlY3RvclwiO1xuaW1wb3J0IHR5cGUgeyBTZWxlY3RvciBhcyBWM1NlbGVjdG9yIH0gZnJvbSBcIi4vdHlwZXMvVjMvU2VsZWN0b3JcIjtcbmltcG9ydCB0eXBlIHsgU291cmNlIH0gZnJvbSBcIi4vdHlwZXMvVjMvU291cmNlXCI7XG5pbXBvcnQgdHlwZSB7IFRhcmdldCB9IGZyb20gXCIuL3R5cGVzL1YzL1RhcmdldFwiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTaW1wbGVBbm5vdGF0aW9uU2VydmVyVjJBZGFwdGVyIHtcbiAgICBjYW52YXNJZDogc3RyaW5nO1xuICAgIGVuZHBvaW50VXJsOiBzdHJpbmc7XG5cbiAgICAvKiogKi9cbiAgICBjb25zdHJ1Y3RvcihjYW52YXNJZDogc3RyaW5nLCBlbmRwb2ludFVybDogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuY2FudmFzSWQgPSBjYW52YXNJZDtcbiAgICAgICAgdGhpcy5lbmRwb2ludFVybCA9IGVuZHBvaW50VXJsO1xuICAgIH1cblxuICAgIC8qKiAqL1xuICAgIGdldCBhbm5vdGF0aW9uUGFnZUlkKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiBgJHt0aGlzLmVuZHBvaW50VXJsfS9zZWFyY2g/dXJpPSR7dGhpcy5jYW52YXNJZH1gO1xuICAgIH1cblxuICAgIC8qKiAqL1xuICAgIGFzeW5jIGNyZWF0ZShhbm5vdGF0aW9uOiBWM0Fubm90YXRpb24pIHtcbiAgICAgICAgcmV0dXJuIGZldGNoKGAke3RoaXMuZW5kcG9pbnRVcmx9L2NyZWF0ZWAsIHtcbiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KFxuICAgICAgICAgICAgICAgIFNpbXBsZUFubm90YXRpb25TZXJ2ZXJWMkFkYXB0ZXIuY3JlYXRlVjJBbm5vKGFubm90YXRpb24pXG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgIEFjY2VwdDogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgfSlcbiAgICAgICAgICAgIC50aGVuKCgpID0+IHRoaXMuYWxsKCkpXG4gICAgICAgICAgICAuY2F0Y2goKCkgPT4gdGhpcy5hbGwoKSk7XG4gICAgfVxuXG4gICAgLyoqICovXG4gICAgYXN5bmMgdXBkYXRlKGFubm90YXRpb246IFYzQW5ub3RhdGlvbikge1xuICAgICAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5lbmRwb2ludFVybH0vdXBkYXRlYCwge1xuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoXG4gICAgICAgICAgICAgICAgU2ltcGxlQW5ub3RhdGlvblNlcnZlclYyQWRhcHRlci5jcmVhdGVWMkFubm8oYW5ub3RhdGlvbilcbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgQWNjZXB0OiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICB9KVxuICAgICAgICAgICAgLnRoZW4oKCkgPT4gdGhpcy5hbGwoKSlcbiAgICAgICAgICAgIC5jYXRjaCgoKSA9PiB0aGlzLmFsbCgpKTtcbiAgICB9XG5cbiAgICAvKiogKi9cbiAgICBhc3luYyBkZWxldGUoYW5ub0lkOiBzdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIGZldGNoKFxuICAgICAgICAgICAgYCR7dGhpcy5lbmRwb2ludFVybH0vZGVzdHJveT91cmk9JHtlbmNvZGVVUklDb21wb25lbnQoYW5ub0lkKX1gLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgQWNjZXB0OiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgICAgICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgICAgICAgICB9XG4gICAgICAgIClcbiAgICAgICAgICAgIC50aGVuKCgpID0+IHRoaXMuYWxsKCkpXG4gICAgICAgICAgICAuY2F0Y2goKCkgPT4gdGhpcy5hbGwoKSk7XG4gICAgfVxuXG4gICAgLyoqICovXG4gICAgYXN5bmMgZ2V0KGFubm9JZDogc3RyaW5nKSB7XG4gICAgICAgIC8vIFNBUyBkb2VzIG5vdCBoYXZlIEdFVCBmb3IgYSBzaW5nbGUgYW5ub3RhdGlvblxuICAgICAgICBjb25zdCBhbm5vdGF0aW9uUGFnZSA9IGF3YWl0IHRoaXMuYWxsKCk7XG4gICAgICAgIGlmIChhbm5vdGF0aW9uUGFnZSkge1xuICAgICAgICAgICAgcmV0dXJuIGFubm90YXRpb25QYWdlLml0ZW1zLmZpbmQoXG4gICAgICAgICAgICAgICAgKGl0ZW06IFYzQW5ub3RhdGlvbikgPT4gaXRlbS5pZCA9PT0gYW5ub0lkXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIC8qKiBSZXR1cm5zIGFuIEFubm90YXRpb25QYWdlIHdpdGggYWxsIGFubm90YXRpb25zICovXG4gICAgYXN5bmMgYWxsKCk6IFByb21pc2U8QW5ub3RhdGlvblBhZ2U+IHtcbiAgICAgICAgY29uc3QgcmVzcCA9IGF3YWl0IGZldGNoKHRoaXMuYW5ub3RhdGlvblBhZ2VJZCk7XG4gICAgICAgIGNvbnN0IGFubm9zID0gYXdhaXQgcmVzcC5qc29uKCk7XG4gICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZUFubm90YXRpb25QYWdlKGFubm9zKTtcbiAgICB9XG5cbiAgICAvKiogQ3JlYXRlcyBhIFYyIGFubm90YXRpb24gZnJvbSBhIFYzIGFubm90YXRpb24gKi9cbiAgICBzdGF0aWMgY3JlYXRlVjJBbm5vKHYzYW5ubzogVjNBbm5vdGF0aW9uKTogVjJBbm5vdGF0aW9uIHtcbiAgICAgICAgbGV0IHJlc291cmNlID0gbnVsbDtcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodjNhbm5vLmJvZHkpKSB7XG4gICAgICAgICAgICByZXNvdXJjZSA9IHYzYW5uby5ib2R5Lm1hcCgoYikgPT4gdGhpcy5jcmVhdGVWMkFubm9Cb2R5KGIpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlc291cmNlID0gdGhpcy5jcmVhdGVWMkFubm9Cb2R5KHYzYW5uby5ib2R5KTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB2MmFubm86IFYyQW5ub3RhdGlvbiA9IHtcbiAgICAgICAgICAgIC8vIGNvcHkgaWQgaWYgaXQgaXMgU0FTLWdlbmVyYXRlZFxuICAgICAgICAgICAgLy8gVE9ETzogV2hhdCBpZCB0byB1c2UgaWYgaXQgaXMgbm90P1xuICAgICAgICAgICAgXCJAaWRcIjogdjNhbm5vLmlkICYmIHYzYW5uby5pZC5zdGFydHNXaXRoKFwiaHR0cFwiKSA/IHYzYW5uby5pZCA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIFwiQGNvbnRleHRcIjogXCJodHRwOi8vaWlpZi5pby9hcGkvcHJlc2VudGF0aW9uLzIvY29udGV4dC5qc29uXCIsXG4gICAgICAgICAgICBcIkB0eXBlXCI6IFwib2E6QW5ub3RhdGlvblwiLFxuICAgICAgICAgICAgbW90aXZhdGlvbjogXCJvYTpjb21tZW50aW5nXCIsIC8vIFRPRE86IHVzZSB2M2Fubm8ubW90aXZhdGlvblxuICAgICAgICAgICAgb246IHtcbiAgICAgICAgICAgICAgICBcIkB0eXBlXCI6IFwib2E6U3BlY2lmaWNSZXNvdXJjZVwiLFxuICAgICAgICAgICAgICAgIGZ1bGw6ICh2M2Fubm8udGFyZ2V0LnNvdXJjZSBhcyBTb3VyY2UpLmlkLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlc291cmNlLFxuICAgICAgICB9O1xuICAgICAgICBpZiAodjNhbm5vLnRhcmdldC5zZWxlY3Rvcikge1xuICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodjNhbm5vLnRhcmdldC5zZWxlY3RvcikpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RvcnMgPSB2M2Fubm8udGFyZ2V0LnNlbGVjdG9yLm1hcCgocykgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAocykge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHYyU2VsZWN0b3IgPSB0aGlzLmNyZWF0ZVYyQW5ub1NlbGVjdG9yKHMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHYyU2VsZWN0b3IpIHJldHVybiB2MlNlbGVjdG9yO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgLy8gY3JlYXRlIGNob2ljZSwgYXNzdW1pbmcgdHdvIGVsZW1lbnRzIGFuZCAwIGlzIGRlZmF1bHRcbiAgICAgICAgICAgICAgICB2MmFubm8ub24uc2VsZWN0b3IgPSB7XG4gICAgICAgICAgICAgICAgICAgIFwiQHR5cGVcIjogXCJvYTpDaG9pY2VcIixcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogc2VsZWN0b3JzWzBdLFxuICAgICAgICAgICAgICAgICAgICBpdGVtOiBzZWxlY3RvcnNbMV0sXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbGV0IHYyU2VsZWN0b3IgPSB0aGlzLmNyZWF0ZVYyQW5ub1NlbGVjdG9yKFxuICAgICAgICAgICAgICAgICAgICB2M2Fubm8udGFyZ2V0LnNlbGVjdG9yXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICBpZiAodjJTZWxlY3RvcikgdjJhbm5vLm9uLnNlbGVjdG9yID0gdjJTZWxlY3RvcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICgodjNhbm5vLnRhcmdldC5zb3VyY2UgYXMgU291cmNlKS5wYXJ0T2YpIHtcbiAgICAgICAgICAgICAgICB2MmFubm8ub24ud2l0aGluID0ge1xuICAgICAgICAgICAgICAgICAgICBcIkBpZFwiOiAodjNhbm5vLnRhcmdldC5zb3VyY2UgYXMgU291cmNlKS5wYXJ0T2YuaWQsXG4gICAgICAgICAgICAgICAgICAgIFwiQHR5cGVcIjogXCJzYzpNYW5pZmVzdFwiLFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHYyYW5ubztcbiAgICB9XG5cbiAgICAvKiogKi9cbiAgICBzdGF0aWMgY3JlYXRlVjJBbm5vQm9keSh2M2JvZHk6IFYzQm9keSkge1xuICAgICAgICBjb25zdCB2MmJvZHk6IFYyQm9keSA9IHtcbiAgICAgICAgICAgIFwiQHR5cGVcIjogdjNib2R5LnB1cnBvc2UgPT09IFwidGFnZ2luZ1wiID8gXCJvYTpUYWdcIiA6IFwiZGN0eXBlczpUZXh0XCIsXG4gICAgICAgICAgICBjaGFyczogdjNib2R5LnZhbHVlLFxuICAgICAgICB9O1xuICAgICAgICBpZiAodjNib2R5LmZvcm1hdCkge1xuICAgICAgICAgICAgdjJib2R5LmZvcm1hdCA9IHYzYm9keS5mb3JtYXQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHYzYm9keS5sYW5ndWFnZSkge1xuICAgICAgICAgICAgdjJib2R5Lmxhbmd1YWdlID0gdjNib2R5Lmxhbmd1YWdlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB2MmJvZHk7XG4gICAgfVxuXG4gICAgLyoqICovXG4gICAgc3RhdGljIGNyZWF0ZVYyQW5ub1NlbGVjdG9yKHYzc2VsZWN0b3I6IFYzU2VsZWN0b3IpOiBWMlNlbGVjdG9yIHwgbnVsbCB7XG4gICAgICAgIHN3aXRjaCAodjNzZWxlY3Rvci50eXBlKSB7XG4gICAgICAgICAgICBjYXNlIFwiU3ZnU2VsZWN0b3JcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBcIkB0eXBlXCI6IFwib2E6U3ZnU2VsZWN0b3JcIixcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHYzc2VsZWN0b3IudmFsdWUsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNhc2UgXCJGcmFnbWVudFNlbGVjdG9yXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgXCJAdHlwZVwiOiBcIm9hOkZyYWdtZW50U2VsZWN0b3JcIixcbiAgICAgICAgICAgICAgICAgICAgLy8gU0FTIHVzZXMgbG9jYXRpb24gaW4geHl3aD14LHksdyxoIGZvcm1hdDsgYW5ub3RvcmlvdXMgdXNlcyBwaXhlbDp4LHksdyxoXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiB2M3NlbGVjdG9yLnZhbHVlLnJlcGxhY2UoXCJ4eXdoPXBpeGVsOlwiLCBcInh5d2g9XCIpLFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqIENyZWF0ZXMgYW4gQW5ub3RhdGlvblBhZ2UgZnJvbSBhIGxpc3Qgb2YgVjIgYW5ub3RhdGlvbnMgKi9cbiAgICBjcmVhdGVBbm5vdGF0aW9uUGFnZSh2MmFubm9zOiBWMkFubm90YXRpb25bXSk6IEFubm90YXRpb25QYWdlIHtcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodjJhbm5vcykpIHtcbiAgICAgICAgICAgIGNvbnN0IHYzYW5ub3MgPSB2MmFubm9zLm1hcCgoYSkgPT5cbiAgICAgICAgICAgICAgICBTaW1wbGVBbm5vdGF0aW9uU2VydmVyVjJBZGFwdGVyLmNyZWF0ZVYzQW5ubyhhKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgaWQ6IHRoaXMuYW5ub3RhdGlvblBhZ2VJZCxcbiAgICAgICAgICAgICAgICBpdGVtczogdjNhbm5vcyxcbiAgICAgICAgICAgICAgICB0eXBlOiBcIkFubm90YXRpb25QYWdlXCIsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB2MmFubm9zO1xuICAgIH1cblxuICAgIC8qKiBDcmVhdGVzIGEgVjMgYW5ub3RhdGlvbiBmcm9tIGEgVjIgYW5ub3RhdGlvbiAqL1xuICAgIHN0YXRpYyBjcmVhdGVWM0Fubm8odjJhbm5vOiBWMkFubm90YXRpb24pOiBWM0Fubm90YXRpb24ge1xuICAgICAgICBsZXQgYm9keSA9IG51bGw7XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KHYyYW5uby5yZXNvdXJjZSkpIHtcbiAgICAgICAgICAgIGJvZHkgPSB2MmFubm8ucmVzb3VyY2UubWFwKChiOiBWMkJvZHkpID0+IHRoaXMuY3JlYXRlVjNBbm5vQm9keShiKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBib2R5ID0gdGhpcy5jcmVhdGVWM0Fubm9Cb2R5KHYyYW5uby5yZXNvdXJjZSk7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHYydGFyZ2V0ID0gdjJhbm5vLm9uO1xuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2MnRhcmdldCkpIHtcbiAgICAgICAgICAgIFt2MnRhcmdldF0gPSB2MnRhcmdldDtcbiAgICAgICAgfVxuICAgICAgICBsZXQgdGFyZ2V0OiBUYXJnZXQgPSB7XG4gICAgICAgICAgICBzZWxlY3RvcjogdjJ0YXJnZXQuc2VsZWN0b3IgPyB0aGlzLmNyZWF0ZVYzQW5ub1NlbGVjdG9yKHYydGFyZ2V0LnNlbGVjdG9yKSA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIHNvdXJjZTogdjJ0YXJnZXQuZnVsbCxcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKHYydGFyZ2V0LndpdGhpbikge1xuICAgICAgICAgICAgdGFyZ2V0LnNvdXJjZSA9IHtcbiAgICAgICAgICAgICAgICBpZDogdjJ0YXJnZXQuZnVsbCxcbiAgICAgICAgICAgICAgICBwYXJ0T2Y6IHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IHYydGFyZ2V0LndpdGhpbltcIkBpZFwiXSxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJNYW5pZmVzdFwiLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdHlwZTogXCJDYW52YXNcIixcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIFwiQGNvbnRleHRcIjogXCJodHRwOi8vd3d3LnczLm9yZy9ucy9hbm5vLmpzb25sZFwiLFxuICAgICAgICAgICAgaWQ6IHYyYW5ub1tcIkBpZFwiXSxcbiAgICAgICAgICAgIG1vdGl2YXRpb246IFwiY29tbWVudGluZ1wiLFxuICAgICAgICAgICAgdHlwZTogXCJBbm5vdGF0aW9uXCIsXG4gICAgICAgICAgICB0YXJnZXQsXG4gICAgICAgICAgICBib2R5LFxuICAgICAgICB9O1xuICAgIH1cblxuICAgIC8qKiAqL1xuICAgIHN0YXRpYyBjcmVhdGVWM0Fubm9Cb2R5KHYyYm9keTogVjJCb2R5KTogVjNCb2R5IHtcbiAgICAgICAgY29uc3QgdjNib2R5OiBWM0JvZHkgPSB7XG4gICAgICAgICAgICB0eXBlOiBcIlRleHR1YWxCb2R5XCIsXG4gICAgICAgICAgICB2YWx1ZTogdjJib2R5LmNoYXJzLFxuICAgICAgICB9O1xuICAgICAgICBpZiAodjJib2R5LmZvcm1hdCkge1xuICAgICAgICAgICAgdjNib2R5LmZvcm1hdCA9IHYyYm9keS5mb3JtYXQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHYyYm9keS5sYW5ndWFnZSkge1xuICAgICAgICAgICAgdjNib2R5Lmxhbmd1YWdlID0gdjJib2R5Lmxhbmd1YWdlO1xuICAgICAgICB9XG4gICAgICAgIGlmICh2MmJvZHlbXCJAdHlwZVwiXSA9PT0gXCJvYTpUYWdcIikge1xuICAgICAgICAgICAgdjNib2R5LnB1cnBvc2UgPSBcInRhZ2dpbmdcIjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdjNib2R5O1xuICAgIH1cblxuICAgIC8qKiAqL1xuICAgIHN0YXRpYyBjcmVhdGVWM0Fubm9TZWxlY3Rvcih2MnNlbGVjdG9yOiBWMlNlbGVjdG9yKTogYW55IHtcbiAgICAgICAgLy8gVE9ETzogdHlwZS1zYWZlIHRoaXMgcmV0dXJuIHZhbHVlXG4gICAgICAgIHN3aXRjaCAodjJzZWxlY3RvcltcIkB0eXBlXCJdKSB7XG4gICAgICAgICAgICBjYXNlIFwib2E6U3ZnU2VsZWN0b3JcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIlN2Z1NlbGVjdG9yXCIsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiB2MnNlbGVjdG9yLnZhbHVlLFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICBjYXNlIFwib2E6RnJhZ21lbnRTZWxlY3RvclwiOlxuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiRnJhZ21lbnRTZWxlY3RvclwiLFxuICAgICAgICAgICAgICAgICAgICBjb25mb3Jtc1RvOiBcImh0dHA6Ly93d3cudzMub3JnL1RSL21lZGlhLWZyYWdzL1wiLFxuICAgICAgICAgICAgICAgICAgICAvLyBTQVMgcmV0dXJucyBsb2NhdGlvbiBpbiB4eXdoPXgseSx3LGggZm9ybWF0OyBhbm5vdG9yaW91cyB1c2VzIHBpeGVsOngseSx3LGhcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHYyc2VsZWN0b3IudmFsdWUgPyB2MnNlbGVjdG9yLnZhbHVlLnJlcGxhY2UoXCJ4eXdoPVwiLCBcInh5d2g9cGl4ZWw6XCIpIDogXCJcIixcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgY2FzZSBcIm9hOkNob2ljZVwiOlxuICAgICAgICAgICAgICAgIC8qIGNyZWF0ZSBhbHRlcm5hdGUgc2VsZWN0b3JzICovXG4gICAgICAgICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICAgICAgICAgdjJzZWxlY3Rvci5kZWZhdWx0XG4gICAgICAgICAgICAgICAgICAgICAgICA/IHRoaXMuY3JlYXRlVjNBbm5vU2VsZWN0b3IodjJzZWxlY3Rvci5kZWZhdWx0KVxuICAgICAgICAgICAgICAgICAgICAgICAgOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICB2MnNlbGVjdG9yLml0ZW1cbiAgICAgICAgICAgICAgICAgICAgICAgID8gdGhpcy5jcmVhdGVWM0Fubm9TZWxlY3Rvcih2MnNlbGVjdG9yLml0ZW0pXG4gICAgICAgICAgICAgICAgICAgICAgICA6IG51bGwsXG4gICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICB9XG59XG4iLCIvLyBhbm5vdG9yaW91cyBwbHVnaW4gdG8gdXNlIHNpbXBsZSBhbm5vdGF0aW9uIHNlcnZlciBhcyBhIHN0b3JhZ2VcblxuaW1wb3J0IFNpbXBsZUFubm90YXRpb25TZXJ2ZXJWMkFkYXB0ZXIgZnJvbSBcIi4vU2ltcGxlQW5ub3RhdGlvblNlcnZlclYyQWRhcHRlclwiO1xuaW1wb3J0IHR5cGUgeyBBbm5vdGF0aW9uLCBTYXZlZEFubm90YXRpb24gfSBmcm9tIFwiLi90eXBlcy9WMy9Bbm5vdGF0aW9uXCI7XG5pbXBvcnQgdHlwZSB7IEFubm90YXRpb25QYWdlIH0gZnJvbSBcIi4vdHlwZXMvVjMvQW5ub3RhdGlvblBhZ2VcIjtcbmltcG9ydCB0eXBlIHsgU2V0dGluZ3MgfSBmcm9tIFwiLi90eXBlcy9TZXR0aW5nc1wiO1xuaW1wb3J0IHR5cGUgeyBUYXJnZXQgfSBmcm9tIFwiLi90eXBlcy9WMy9UYXJnZXRcIjtcblxuLy8gZGVmaW5lIGEgY3VzdG9tIGV2ZW50IHRvIGluZGljYXRlIHRoYXQgYW5ub3RhdGlvbnMgaGF2ZSBiZWVuIGxvYWRlZFxuY29uc3QgQW5ub0xvYWRFdmVudCA9IG5ldyBFdmVudChcImFubm90YXRpb25zLWxvYWRlZFwiKTtcblxuY29uc3QgQW5ub3RhdGlvblNlcnZlclN0b3JhZ2UgPSAoYW5ubzogYW55LCBzZXR0aW5nczogU2V0dGluZ3MpID0+IHtcbiAgICBsZXQgYWRhcHRlciA9IG5ldyBTaW1wbGVBbm5vdGF0aW9uU2VydmVyVjJBZGFwdGVyKFxuICAgICAgICBzZXR0aW5ncy50YXJnZXQsIC8vIHNob3VsZCBiZSBjYW52YXMgaWRcbiAgICAgICAgc2V0dGluZ3MuYW5ub3RhdGlvbkVuZHBvaW50XG4gICAgKTtcblxuICAgIC8vIGxvYWQgYW5kIGRpc3BsYXkgYW5ub3RhdGlvbnMgZnJvbSBzZXJ2ZXJcbiAgICBhZGFwdGVyLmFsbCgpLnRoZW4oKGFubm90YXRpb25QYWdlOiBBbm5vdGF0aW9uUGFnZSkgPT4ge1xuICAgICAgICBhbm5vLnNldEFubm90YXRpb25zKGFubm90YXRpb25QYWdlLml0ZW1zKTtcbiAgICAgICAgZG9jdW1lbnQuZGlzcGF0Y2hFdmVudChBbm5vTG9hZEV2ZW50KTtcbiAgICB9KTtcblxuICAgIGZ1bmN0aW9uIGFkanVzdFRhcmdldFNvdXJjZSh0YXJnZXQ6IFRhcmdldCkge1xuICAgICAgICAvLyBhbm5vdG9yaW91cyBzZXRzIHRoZSB0YXJnZXQgc291cmNlIGFzIGEgc3RyaW5nIGlkO1xuICAgICAgICAvLyB3ZSBuZWVkIHRvIHN0cnVjdHVyZSBpdCB0byBhZGQgY2FudmFzL21hbmlmZXN0IGluZm9cbiAgICAgICAgaWYgKHR5cGVvZiB0YXJnZXQuc291cmNlID09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgIC8vIGFkZCBtYW5pZmVzdCBpZCB0byBhbm5vdGF0aW9uXG4gICAgICAgICAgICB0YXJnZXQuc291cmNlID0ge1xuICAgICAgICAgICAgICAgIC8vIHVzZSB0aGUgY29uZmlndXJlZCB0YXJnZXQgKHNob3VsZCBiZSBjYW52YXMgaWQpXG4gICAgICAgICAgICAgICAgaWQ6IHNldHRpbmdzLnRhcmdldCxcbiAgICAgICAgICAgICAgICAvLyBsaW5rIHRvIGNvbnRhaW5pbmcgbWFuaWZlc3RcbiAgICAgICAgICAgICAgICBwYXJ0T2Y6IHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IHNldHRpbmdzLm1hbmlmZXN0LFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIk1hbmlmZXN0XCIsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB0eXBlOiBcIkNhbnZhc1wiLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIGNyZWF0ZSBhIG5ldyBhbm5vdGF0aW9uXG4gICAgYW5uby5vbihcImNyZWF0ZUFubm90YXRpb25cIiwgYXN5bmMgKGFubm90YXRpb246IEFubm90YXRpb24pID0+IHtcbiAgICAgICAgYWRqdXN0VGFyZ2V0U291cmNlKGFubm90YXRpb24udGFyZ2V0KTtcbiAgICAgICAgYWRhcHRlci5jcmVhdGUoYW5ub3RhdGlvbikudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAvLyBieSBkZWZhdWx0LCBzdG9yYWdlIHJlbG9hZHMgYWxsIGFubm90YXRpb25zIGZvciB0aGlzIHBhZ2U7XG4gICAgICAgICAgICAvLyBzaWduYWwgdGhhdCBhbm5vdGF0aW9ucyBoYXZlIGJlZW4gbG9hZGVkXG4gICAgICAgICAgICBkb2N1bWVudC5kaXNwYXRjaEV2ZW50KEFubm9Mb2FkRXZlbnQpO1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gaG93IHRvIHVwZGF0ZSBpZCBmb3IgYW5ub3RvcmlvdXM/XG4gICAgICAgIGNvbnNvbGUubG9nKGFubm90YXRpb24pO1xuICAgICAgICBhbm5vLmFkZEFubm90YXRpb24oYW5ub3RhdGlvbik7XG4gICAgICAgIHJldHVybiBhbm5vdGF0aW9uO1xuICAgIH0pO1xuXG4gICAgLy8gdXBkYXRlIGFuIGFubm90YXRpb25cbiAgICBhbm5vLm9uKFxuICAgICAgICBcInVwZGF0ZUFubm90YXRpb25cIixcbiAgICAgICAgKGFubm90YXRpb246IEFubm90YXRpb24sIHByZXZpb3VzOiBBbm5vdGF0aW9uKSA9PiB7XG4gICAgICAgICAgICAvLyBUaGUgcG9zdGVkIGFubm90YXRpb24gc2hvdWxkIGhhdmUgYW4gQGlkIHdoaWNoIGV4aXN0cyBpbiB0aGUgc3RvcmVcbiAgICAgICAgICAgIGxldCBuZXdJZCA9IGFubm90YXRpb24uaWQ7IC8vIGRvIHdlIG5lZWQgdG8gZG8gYW55dGhpbmcgd2l0aCB0aGlzP1xuICAgICAgICAgICAgYW5ub3RhdGlvbi5pZCA9IHByZXZpb3VzLmlkO1xuICAgICAgICAgICAgLy8gdGFyZ2V0IG5lZWRzIHRvIGJlIHVwZGF0ZWQgaWYgdGhlIGltYWdlIHNlbGVjdGlvbiBoYXMgY2hhbmdlZFxuICAgICAgICAgICAgYWRqdXN0VGFyZ2V0U291cmNlKGFubm90YXRpb24udGFyZ2V0KTtcbiAgICAgICAgICAgIGFkYXB0ZXIudXBkYXRlKGFubm90YXRpb24pO1xuICAgICAgICAgICAgLy8gYWRkIHRoZSBhbm5vdGF0aW9uIHRvIGFubm90b3Jpb3VzIGFnYWluIHRvIG1ha2Ugc3VyZSB0aGUgZGlzcGxheSBpcyB1cCB0byBkYXRlXG4gICAgICAgICAgICBhbm5vLmFkZEFubm90YXRpb24oYW5ub3RhdGlvbik7XG4gICAgICAgIH1cbiAgICApO1xuXG4gICAgLy8gZGVsZXRlIGFuIGFubm90YXRpb25cbiAgICBhbm5vLm9uKFwiZGVsZXRlQW5ub3RhdGlvblwiLCAoYW5ub3RhdGlvbjogU2F2ZWRBbm5vdGF0aW9uKSA9PiB7XG4gICAgICAgIGFkYXB0ZXIuZGVsZXRlKGFubm90YXRpb24uaWQpO1xuICAgIH0pO1xuXG4gICAgY29uc3Qgc3RvcmFnZVBsdWdpbiA9IHtcbiAgICAgICAgYWRhcHRlcjogYWRhcHRlcixcbiAgICB9O1xuXG4gICAgcmV0dXJuIHN0b3JhZ2VQbHVnaW47XG59O1xuXG5leHBvcnQgZGVmYXVsdCBBbm5vdGF0aW9uU2VydmVyU3RvcmFnZTtcbiIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4iLCIvLyBzdGFydHVwXG4vLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbi8vIFRoaXMgZW50cnkgbW9kdWxlIGlzIHJlZmVyZW5jZWQgYnkgb3RoZXIgbW9kdWxlcyBzbyBpdCBjYW4ndCBiZSBpbmxpbmVkXG52YXIgX193ZWJwYWNrX2V4cG9ydHNfXyA9IF9fd2VicGFja19yZXF1aXJlX18oNjA3KTtcbiJdLCJuYW1lcyI6WyJTaW1wbGVBbm5vdGF0aW9uU2VydmVyVjJBZGFwdGVyIiwiY29uc3RydWN0b3IiLCJjYW52YXNJZCIsImVuZHBvaW50VXJsIiwidGhpcyIsImFubm90YXRpb25QYWdlSWQiLCJhc3luYyIsImFubm90YXRpb24iLCJmZXRjaCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiY3JlYXRlVjJBbm5vIiwiaGVhZGVycyIsIkFjY2VwdCIsIm1ldGhvZCIsInRoZW4iLCJhbGwiLCJjYXRjaCIsImFubm9JZCIsImVuY29kZVVSSUNvbXBvbmVudCIsImFubm90YXRpb25QYWdlIiwiaXRlbXMiLCJmaW5kIiwiaXRlbSIsImlkIiwicmVzcCIsImFubm9zIiwianNvbiIsImNyZWF0ZUFubm90YXRpb25QYWdlIiwic3RhdGljIiwidjNhbm5vIiwicmVzb3VyY2UiLCJBcnJheSIsImlzQXJyYXkiLCJtYXAiLCJiIiwiY3JlYXRlVjJBbm5vQm9keSIsInYyYW5ubyIsInN0YXJ0c1dpdGgiLCJ1bmRlZmluZWQiLCJtb3RpdmF0aW9uIiwib24iLCJmdWxsIiwidGFyZ2V0Iiwic291cmNlIiwic2VsZWN0b3IiLCJzZWxlY3RvcnMiLCJzIiwidjJTZWxlY3RvciIsImNyZWF0ZVYyQW5ub1NlbGVjdG9yIiwiZGVmYXVsdCIsInBhcnRPZiIsIndpdGhpbiIsInYzYm9keSIsInYyYm9keSIsInB1cnBvc2UiLCJjaGFycyIsInZhbHVlIiwiZm9ybWF0IiwibGFuZ3VhZ2UiLCJ2M3NlbGVjdG9yIiwidHlwZSIsInJlcGxhY2UiLCJ2MmFubm9zIiwidjNhbm5vcyIsImEiLCJjcmVhdGVWM0Fubm8iLCJjcmVhdGVWM0Fubm9Cb2R5IiwidjJ0YXJnZXQiLCJjcmVhdGVWM0Fubm9TZWxlY3RvciIsInYyc2VsZWN0b3IiLCJjb25mb3Jtc1RvIiwiQW5ub0xvYWRFdmVudCIsIkV2ZW50IiwiYW5ubyIsInNldHRpbmdzIiwiYWRhcHRlciIsImFubm90YXRpb25FbmRwb2ludCIsImFkanVzdFRhcmdldFNvdXJjZSIsIm1hbmlmZXN0Iiwic2V0QW5ub3RhdGlvbnMiLCJkb2N1bWVudCIsImRpc3BhdGNoRXZlbnQiLCJjcmVhdGUiLCJjb25zb2xlIiwibG9nIiwiYWRkQW5ub3RhdGlvbiIsInByZXZpb3VzIiwidXBkYXRlIiwiZGVsZXRlIiwiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX2V4cG9ydHNfXyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImNhY2hlZE1vZHVsZSIsImV4cG9ydHMiLCJtb2R1bGUiLCJfX3dlYnBhY2tfbW9kdWxlc19fIiwiY2FsbCJdLCJzb3VyY2VSb290IjoiIn0=