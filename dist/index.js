(()=>{"use strict";var t={607:function(t,e,a){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(a(55)),r=n(a(732)),i=new Event("annotations-loaded");e.default=(t,e)=>{let a=new o.default(e.target,e.annotationEndpoint);return a.all().then((e=>{t.setAnnotations(e.items),document.dispatchEvent(i)})),t.on("createAnnotation",(async n=>(n.target.source=(0,r.default)(n.target.source,e),a.create(n).then((()=>{document.dispatchEvent(i)})),console.log(n),t.addAnnotation(n),n))),t.on("updateAnnotation",((n,o)=>{n.id,n.id=o.id,n.target.source=(0,r.default)(n.target.source,e),a.update(n),t.addAnnotation(n)})),t.on("deleteAnnotation",(t=>{a.delete(t.id)})),{adapter:a}}},55:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});class a{constructor(t,e){this.canvasId=t,this.endpointUrl=e}get annotationPageId(){return`${this.endpointUrl}/search?uri=${this.canvasId}`}async create(t){return fetch(`${this.endpointUrl}/create`,{body:JSON.stringify(a.createV2Anno(t)),headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST"}).then((()=>this.all())).catch((()=>this.all()))}async update(t){return fetch(`${this.endpointUrl}/update`,{body:JSON.stringify(a.createV2Anno(t)),headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST"}).then((()=>this.all())).catch((()=>this.all()))}async delete(t){return fetch(`${this.endpointUrl}/destroy?uri=${encodeURIComponent(t)}`,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"DELETE"}).then((()=>this.all())).catch((()=>this.all()))}async get(t){const e=await this.all();return e?e.items.find((e=>e.id===t)):null}async all(){const t=await fetch(this.annotationPageId),e=await t.json();return this.createAnnotationPage(e)}static createV2Anno(t){let e=null;e=Array.isArray(t.body)?t.body.map((t=>this.createV2AnnoBody(t))):this.createV2AnnoBody(t.body);const a={"@id":t.id&&t.id.startsWith("http")?t.id:void 0,"@context":"http://iiif.io/api/presentation/2/context.json","@type":"oa:Annotation",motivation:"oa:commenting",on:{"@type":"oa:SpecificResource",full:t.target.source.id},resource:e};if(t.target.selector){if(Array.isArray(t.target.selector)){const e=t.target.selector.map((t=>{if(t){let e=this.createV2AnnoSelector(t);if(e)return e}}));a.on.selector={"@type":"oa:Choice",default:e[0],item:e[1]}}else{let e=this.createV2AnnoSelector(t.target.selector);e&&(a.on.selector=e)}t.target.source.partOf&&(a.on.within={"@id":t.target.source.partOf.id,"@type":"sc:Manifest"})}return a}static createV2AnnoBody(t){const e={"@type":"tagging"===t.purpose?"oa:Tag":"dctypes:Text",chars:t.value};return t.format&&(e.format=t.format),t.language&&(e.language=t.language),e}static createV2AnnoSelector(t){switch(t.type){case"SvgSelector":return{"@type":"oa:SvgSelector",value:t.value};case"FragmentSelector":return{"@type":"oa:FragmentSelector",value:t.value.replace("xywh=pixel:","xywh=")};default:return null}}createAnnotationPage(t){if(Array.isArray(t)){const e=t.map((t=>a.createV3Anno(t)));return{id:this.annotationPageId,items:e,type:"AnnotationPage"}}return t}static createV3Anno(t){let e=null;e=Array.isArray(t.resource)?t.resource.map((t=>this.createV3AnnoBody(t))):this.createV3AnnoBody(t.resource);let a=t.on;Array.isArray(a)&&([a]=a);let n={selector:a.selector?this.createV3AnnoSelector(a.selector):void 0,source:a.full};return a.within&&(n.source={id:a.full,partOf:{id:a.within["@id"],type:"Manifest"},type:"Canvas"}),{"@context":"http://www.w3.org/ns/anno.jsonld",id:t["@id"],motivation:"commenting",type:"Annotation",target:n,body:e}}static createV3AnnoBody(t){const e={type:"TextualBody",value:t.chars};return t.format&&(e.format=t.format),t.language&&(e.language=t.language),"oa:Tag"===t["@type"]&&(e.purpose="tagging"),e}static createV3AnnoSelector(t){switch(t["@type"]){case"oa:SvgSelector":return{type:"SvgSelector",value:t.value};case"oa:FragmentSelector":return{type:"FragmentSelector",conformsTo:"http://www.w3.org/TR/media-frags/",value:t.value?t.value.replace("xywh=","xywh=pixel:"):""};case"oa:Choice":return[t.default?this.createV3AnnoSelector(t.default):null,t.item?this.createV3AnnoSelector(t.item):null];default:return null}}}e.default=a},732:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=(t,e)=>("string"==typeof t&&(t={id:e.target,partOf:{id:e.manifest,type:"Manifest"},type:"Canvas"}),t)}},e={},a=function a(n){var o=e[n];if(void 0!==o)return o.exports;var r=e[n]={exports:{}};return t[n].call(r.exports,r,r.exports,a),r.exports}(607);module.exports=a})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TlUsV0FBWSxvQ0FFWmQsTUFBT2EsRUFBV2IsTUFBUWEsRUFBV2IsTUFBTUssUUFBUSxRQUFTLGVBQWlCLElBRXJGLElBQUssWUFFRCxNQUFPLENBQ0hRLEVBQVdwQixRQUNMckMsS0FBS3dELHFCQUFxQkMsRUFBV3BCLFNBQ3JDLEtBQ05vQixFQUFXM0MsS0FDTGQsS0FBS3dELHFCQUFxQkMsRUFBVzNDLE1BQ3JDLE1BRWQsUUFDSSxPQUFPLE9BdlF2QixhLDZEQ0lBLFVBbkIyQixDQUFDM0IsRUFBeUJkLEtBRzVCLGlCQUFWYyxJQUVQQSxFQUFTLENBRUxNLEdBQUlwQixFQUFTRSxPQUViK0QsT0FBUSxDQUNKN0MsR0FBSXBCLEVBQVNzRixTQUNiWCxLQUFNLFlBRVZBLEtBQU0sV0FHUDdELEtDbEJQeUUsRUFBMkIsR0NFM0JDLEVEQ0osU0FBU0MsRUFBb0JDLEdBRTVCLElBQUlDLEVBQWVKLEVBQXlCRyxHQUM1QyxRQUFxQmxDLElBQWpCbUMsRUFDSCxPQUFPQSxFQUFhQyxRQUdyQixJQUFJQyxFQUFTTixFQUF5QkcsR0FBWSxDQUdqREUsUUFBUyxJQU9WLE9BSEFFLEVBQW9CSixHQUFVSyxLQUFLRixFQUFPRCxRQUFTQyxFQUFRQSxFQUFPRCxRQUFTSCxHQUdwRUksRUFBT0QsUUNsQldILENBQW9CLEsiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9hbm5vdG9yaW91cy1zYXMtc3RvcmFnZS8uL3NyYy9pbmRleC50cyIsIndlYnBhY2s6Ly9hbm5vdG9yaW91cy1zYXMtc3RvcmFnZS8uL3NyYy91dGlscy9TaW1wbGVBbm5vdGF0aW9uU2VydmVyVjJBZGFwdGVyLnRzIiwid2VicGFjazovL2Fubm90b3Jpb3VzLXNhcy1zdG9yYWdlLy4vc3JjL3V0aWxzL2FkanVzdFRhcmdldFNvdXJjZS50cyIsIndlYnBhY2s6Ly9hbm5vdG9yaW91cy1zYXMtc3RvcmFnZS93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9hbm5vdG9yaW91cy1zYXMtc3RvcmFnZS93ZWJwYWNrL3N0YXJ0dXAiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gYW5ub3RvcmlvdXMgcGx1Z2luIHRvIHVzZSBzaW1wbGUgYW5ub3RhdGlvbiBzZXJ2ZXIgYXMgYSBzdG9yYWdlXG5cbmltcG9ydCBTaW1wbGVBbm5vdGF0aW9uU2VydmVyVjJBZGFwdGVyIGZyb20gXCIuL3V0aWxzL1NpbXBsZUFubm90YXRpb25TZXJ2ZXJWMkFkYXB0ZXJcIjtcbmltcG9ydCBhZGp1c3RUYXJnZXRTb3VyY2UgZnJvbSBcIi4vdXRpbHMvYWRqdXN0VGFyZ2V0U291cmNlXCI7XG5pbXBvcnQgdHlwZSB7IEFubm90YXRpb24sIFNhdmVkQW5ub3RhdGlvbiB9IGZyb20gXCIuL3R5cGVzL1YzL0Fubm90YXRpb25cIjtcbmltcG9ydCB0eXBlIHsgQW5ub3RhdGlvblBhZ2UgfSBmcm9tIFwiLi90eXBlcy9WMy9Bbm5vdGF0aW9uUGFnZVwiO1xuaW1wb3J0IHR5cGUgeyBTZXR0aW5ncyB9IGZyb20gXCIuL3R5cGVzL1NldHRpbmdzXCI7XG5cbi8vIGRlZmluZSBhIGN1c3RvbSBldmVudCB0byBpbmRpY2F0ZSB0aGF0IGFubm90YXRpb25zIGhhdmUgYmVlbiBsb2FkZWRcbmNvbnN0IEFubm9Mb2FkRXZlbnQgPSBuZXcgRXZlbnQoXCJhbm5vdGF0aW9ucy1sb2FkZWRcIik7XG5cbmNvbnN0IEFubm90YXRpb25TZXJ2ZXJTdG9yYWdlID0gKGFubm86IGFueSwgc2V0dGluZ3M6IFNldHRpbmdzKSA9PiB7XG4gICAgbGV0IGFkYXB0ZXIgPSBuZXcgU2ltcGxlQW5ub3RhdGlvblNlcnZlclYyQWRhcHRlcihcbiAgICAgICAgc2V0dGluZ3MudGFyZ2V0LCAvLyBzaG91bGQgYmUgY2FudmFzIGlkXG4gICAgICAgIHNldHRpbmdzLmFubm90YXRpb25FbmRwb2ludFxuICAgICk7XG5cbiAgICAvLyBsb2FkIGFuZCBkaXNwbGF5IGFubm90YXRpb25zIGZyb20gc2VydmVyXG4gICAgYWRhcHRlci5hbGwoKS50aGVuKChhbm5vdGF0aW9uUGFnZTogQW5ub3RhdGlvblBhZ2UpID0+IHtcbiAgICAgICAgYW5uby5zZXRBbm5vdGF0aW9ucyhhbm5vdGF0aW9uUGFnZS5pdGVtcyk7XG4gICAgICAgIGRvY3VtZW50LmRpc3BhdGNoRXZlbnQoQW5ub0xvYWRFdmVudCk7XG4gICAgfSk7XG5cbiAgICAvLyBjcmVhdGUgYSBuZXcgYW5ub3RhdGlvblxuICAgIGFubm8ub24oXCJjcmVhdGVBbm5vdGF0aW9uXCIsIGFzeW5jIChhbm5vdGF0aW9uOiBBbm5vdGF0aW9uKSA9PiB7XG4gICAgICAgIGFubm90YXRpb24udGFyZ2V0LnNvdXJjZSA9IGFkanVzdFRhcmdldFNvdXJjZShhbm5vdGF0aW9uLnRhcmdldC5zb3VyY2UsIHNldHRpbmdzKTtcbiAgICAgICAgYWRhcHRlci5jcmVhdGUoYW5ub3RhdGlvbikudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAvLyBieSBkZWZhdWx0LCBzdG9yYWdlIHJlbG9hZHMgYWxsIGFubm90YXRpb25zIGZvciB0aGlzIHBhZ2U7XG4gICAgICAgICAgICAvLyBzaWduYWwgdGhhdCBhbm5vdGF0aW9ucyBoYXZlIGJlZW4gbG9hZGVkXG4gICAgICAgICAgICBkb2N1bWVudC5kaXNwYXRjaEV2ZW50KEFubm9Mb2FkRXZlbnQpO1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gaG93IHRvIHVwZGF0ZSBpZCBmb3IgYW5ub3RvcmlvdXM/XG4gICAgICAgIGNvbnNvbGUubG9nKGFubm90YXRpb24pO1xuICAgICAgICBhbm5vLmFkZEFubm90YXRpb24oYW5ub3RhdGlvbik7XG4gICAgICAgIHJldHVybiBhbm5vdGF0aW9uO1xuICAgIH0pO1xuXG4gICAgLy8gdXBkYXRlIGFuIGFubm90YXRpb25cbiAgICBhbm5vLm9uKFxuICAgICAgICBcInVwZGF0ZUFubm90YXRpb25cIixcbiAgICAgICAgKGFubm90YXRpb246IEFubm90YXRpb24sIHByZXZpb3VzOiBBbm5vdGF0aW9uKSA9PiB7XG4gICAgICAgICAgICAvLyBUaGUgcG9zdGVkIGFubm90YXRpb24gc2hvdWxkIGhhdmUgYW4gQGlkIHdoaWNoIGV4aXN0cyBpbiB0aGUgc3RvcmVcbiAgICAgICAgICAgIGxldCBuZXdJZCA9IGFubm90YXRpb24uaWQ7IC8vIGRvIHdlIG5lZWQgdG8gZG8gYW55dGhpbmcgd2l0aCB0aGlzP1xuICAgICAgICAgICAgYW5ub3RhdGlvbi5pZCA9IHByZXZpb3VzLmlkO1xuICAgICAgICAgICAgLy8gdGFyZ2V0IG5lZWRzIHRvIGJlIHVwZGF0ZWQgaWYgdGhlIGltYWdlIHNlbGVjdGlvbiBoYXMgY2hhbmdlZFxuICAgICAgICAgICAgYW5ub3RhdGlvbi50YXJnZXQuc291cmNlID0gYWRqdXN0VGFyZ2V0U291cmNlKGFubm90YXRpb24udGFyZ2V0LnNvdXJjZSwgc2V0dGluZ3MpO1xuICAgICAgICAgICAgYWRhcHRlci51cGRhdGUoYW5ub3RhdGlvbik7XG4gICAgICAgICAgICAvLyBhZGQgdGhlIGFubm90YXRpb24gdG8gYW5ub3RvcmlvdXMgYWdhaW4gdG8gbWFrZSBzdXJlIHRoZSBkaXNwbGF5IGlzIHVwIHRvIGRhdGVcbiAgICAgICAgICAgIGFubm8uYWRkQW5ub3RhdGlvbihhbm5vdGF0aW9uKTtcbiAgICAgICAgfVxuICAgICk7XG5cbiAgICAvLyBkZWxldGUgYW4gYW5ub3RhdGlvblxuICAgIGFubm8ub24oXCJkZWxldGVBbm5vdGF0aW9uXCIsIChhbm5vdGF0aW9uOiBTYXZlZEFubm90YXRpb24pID0+IHtcbiAgICAgICAgYWRhcHRlci5kZWxldGUoYW5ub3RhdGlvbi5pZCk7XG4gICAgfSk7XG5cbiAgICBjb25zdCBzdG9yYWdlUGx1Z2luID0ge1xuICAgICAgICBhZGFwdGVyOiBhZGFwdGVyLFxuICAgIH07XG5cbiAgICByZXR1cm4gc3RvcmFnZVBsdWdpbjtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IEFubm90YXRpb25TZXJ2ZXJTdG9yYWdlO1xuIiwiLyogQ29udmVydCBiZXR3ZWVuIHYyIChvcGVuIGFubm90YXRpb24pIGFuZCB2MyAodzNjKSBhbm5vdGF0aW9uc1xuICAgaW4gb3JkZXIgdG8gYnJpZGdlIGJldHdlZW4gYW5ub3RvcmlvdXMgKHczYykgYW5kIHNpbXBsZSBhbm5vdGF0aW9uIHNlcnZlciAodjIpLlxuXG4gICBBZGFwdGVkIGZyb20gbWlyYWRvci1hbm5vdGF0aW9ucyBjb2RlXG4gICBodHRwczovL2dpdGh1Yi5jb20vUHJvamVjdE1pcmFkb3IvbWlyYWRvci1hbm5vdGF0aW9ucy9ibG9iL21hc3Rlci9zcmMvU2ltcGxlQW5ub3RhdGlvblNlcnZlclYyQWRhcHRlci5qc1xuXG4qL1xuXG5pbXBvcnQgdHlwZSB7IEFubm90YXRpb24gYXMgVjJBbm5vdGF0aW9uIH0gZnJvbSBcIi4uL3R5cGVzL1YyL0Fubm90YXRpb25cIjtcbmltcG9ydCB0eXBlIHsgQW5ub3RhdGlvbiBhcyBWM0Fubm90YXRpb24gfSBmcm9tIFwiLi4vdHlwZXMvVjMvQW5ub3RhdGlvblwiO1xuaW1wb3J0IHR5cGUgeyBBbm5vdGF0aW9uUGFnZSB9IGZyb20gXCIuLi90eXBlcy9WMy9Bbm5vdGF0aW9uUGFnZVwiO1xuaW1wb3J0IHR5cGUgeyBCb2R5IGFzIFYyQm9keSB9IGZyb20gXCIuLi90eXBlcy9WMi9Cb2R5XCI7XG5pbXBvcnQgdHlwZSB7IEJvZHkgYXMgVjNCb2R5IH0gZnJvbSBcIi4uL3R5cGVzL1YzL0JvZHlcIjtcbmltcG9ydCB0eXBlIHsgU2VsZWN0b3IgYXMgVjJTZWxlY3RvciB9IGZyb20gXCIuLi90eXBlcy9WMi9TZWxlY3RvclwiO1xuaW1wb3J0IHR5cGUgeyBTZWxlY3RvciBhcyBWM1NlbGVjdG9yIH0gZnJvbSBcIi4uL3R5cGVzL1YzL1NlbGVjdG9yXCI7XG5pbXBvcnQgdHlwZSB7IFNvdXJjZSB9IGZyb20gXCIuLi90eXBlcy9WMy9Tb3VyY2VcIjtcbmltcG9ydCB0eXBlIHsgVGFyZ2V0IH0gZnJvbSBcIi4uL3R5cGVzL1YzL1RhcmdldFwiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTaW1wbGVBbm5vdGF0aW9uU2VydmVyVjJBZGFwdGVyIHtcbiAgICBjYW52YXNJZDogc3RyaW5nO1xuICAgIGVuZHBvaW50VXJsOiBzdHJpbmc7XG5cbiAgICAvKiogKi9cbiAgICBjb25zdHJ1Y3RvcihjYW52YXNJZDogc3RyaW5nLCBlbmRwb2ludFVybDogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuY2FudmFzSWQgPSBjYW52YXNJZDtcbiAgICAgICAgdGhpcy5lbmRwb2ludFVybCA9IGVuZHBvaW50VXJsO1xuICAgIH1cblxuICAgIC8qKiAqL1xuICAgIGdldCBhbm5vdGF0aW9uUGFnZUlkKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiBgJHt0aGlzLmVuZHBvaW50VXJsfS9zZWFyY2g/dXJpPSR7dGhpcy5jYW52YXNJZH1gO1xuICAgIH1cblxuICAgIC8qKiAqL1xuICAgIGFzeW5jIGNyZWF0ZShhbm5vdGF0aW9uOiBWM0Fubm90YXRpb24pIHtcbiAgICAgICAgcmV0dXJuIGZldGNoKGAke3RoaXMuZW5kcG9pbnRVcmx9L2NyZWF0ZWAsIHtcbiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KFxuICAgICAgICAgICAgICAgIFNpbXBsZUFubm90YXRpb25TZXJ2ZXJWMkFkYXB0ZXIuY3JlYXRlVjJBbm5vKGFubm90YXRpb24pXG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgIEFjY2VwdDogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgfSlcbiAgICAgICAgICAgIC50aGVuKCgpID0+IHRoaXMuYWxsKCkpXG4gICAgICAgICAgICAuY2F0Y2goKCkgPT4gdGhpcy5hbGwoKSk7XG4gICAgfVxuXG4gICAgLyoqICovXG4gICAgYXN5bmMgdXBkYXRlKGFubm90YXRpb246IFYzQW5ub3RhdGlvbikge1xuICAgICAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5lbmRwb2ludFVybH0vdXBkYXRlYCwge1xuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoXG4gICAgICAgICAgICAgICAgU2ltcGxlQW5ub3RhdGlvblNlcnZlclYyQWRhcHRlci5jcmVhdGVWMkFubm8oYW5ub3RhdGlvbilcbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgQWNjZXB0OiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICB9KVxuICAgICAgICAgICAgLnRoZW4oKCkgPT4gdGhpcy5hbGwoKSlcbiAgICAgICAgICAgIC5jYXRjaCgoKSA9PiB0aGlzLmFsbCgpKTtcbiAgICB9XG5cbiAgICAvKiogKi9cbiAgICBhc3luYyBkZWxldGUoYW5ub0lkOiBzdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIGZldGNoKFxuICAgICAgICAgICAgYCR7dGhpcy5lbmRwb2ludFVybH0vZGVzdHJveT91cmk9JHtlbmNvZGVVUklDb21wb25lbnQoYW5ub0lkKX1gLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgQWNjZXB0OiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgICAgICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgICAgICAgICB9XG4gICAgICAgIClcbiAgICAgICAgICAgIC50aGVuKCgpID0+IHRoaXMuYWxsKCkpXG4gICAgICAgICAgICAuY2F0Y2goKCkgPT4gdGhpcy5hbGwoKSk7XG4gICAgfVxuXG4gICAgLyoqICovXG4gICAgYXN5bmMgZ2V0KGFubm9JZDogc3RyaW5nKSB7XG4gICAgICAgIC8vIFNBUyBkb2VzIG5vdCBoYXZlIEdFVCBmb3IgYSBzaW5nbGUgYW5ub3RhdGlvblxuICAgICAgICBjb25zdCBhbm5vdGF0aW9uUGFnZSA9IGF3YWl0IHRoaXMuYWxsKCk7XG4gICAgICAgIGlmIChhbm5vdGF0aW9uUGFnZSkge1xuICAgICAgICAgICAgcmV0dXJuIGFubm90YXRpb25QYWdlLml0ZW1zLmZpbmQoXG4gICAgICAgICAgICAgICAgKGl0ZW06IFYzQW5ub3RhdGlvbikgPT4gaXRlbS5pZCA9PT0gYW5ub0lkXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIC8qKiBSZXR1cm5zIGFuIEFubm90YXRpb25QYWdlIHdpdGggYWxsIGFubm90YXRpb25zICovXG4gICAgYXN5bmMgYWxsKCk6IFByb21pc2U8QW5ub3RhdGlvblBhZ2U+IHtcbiAgICAgICAgY29uc3QgcmVzcCA9IGF3YWl0IGZldGNoKHRoaXMuYW5ub3RhdGlvblBhZ2VJZCk7XG4gICAgICAgIGNvbnN0IGFubm9zID0gYXdhaXQgcmVzcC5qc29uKCk7XG4gICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZUFubm90YXRpb25QYWdlKGFubm9zKTtcbiAgICB9XG5cbiAgICAvKiogQ3JlYXRlcyBhIFYyIGFubm90YXRpb24gZnJvbSBhIFYzIGFubm90YXRpb24gKi9cbiAgICBzdGF0aWMgY3JlYXRlVjJBbm5vKHYzYW5ubzogVjNBbm5vdGF0aW9uKTogVjJBbm5vdGF0aW9uIHtcbiAgICAgICAgbGV0IHJlc291cmNlID0gbnVsbDtcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodjNhbm5vLmJvZHkpKSB7XG4gICAgICAgICAgICByZXNvdXJjZSA9IHYzYW5uby5ib2R5Lm1hcCgoYikgPT4gdGhpcy5jcmVhdGVWMkFubm9Cb2R5KGIpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlc291cmNlID0gdGhpcy5jcmVhdGVWMkFubm9Cb2R5KHYzYW5uby5ib2R5KTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB2MmFubm86IFYyQW5ub3RhdGlvbiA9IHtcbiAgICAgICAgICAgIC8vIGNvcHkgaWQgaWYgaXQgaXMgU0FTLWdlbmVyYXRlZFxuICAgICAgICAgICAgLy8gVE9ETzogV2hhdCBpZCB0byB1c2UgaWYgaXQgaXMgbm90P1xuICAgICAgICAgICAgXCJAaWRcIjogdjNhbm5vLmlkICYmIHYzYW5uby5pZC5zdGFydHNXaXRoKFwiaHR0cFwiKSA/IHYzYW5uby5pZCA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIFwiQGNvbnRleHRcIjogXCJodHRwOi8vaWlpZi5pby9hcGkvcHJlc2VudGF0aW9uLzIvY29udGV4dC5qc29uXCIsXG4gICAgICAgICAgICBcIkB0eXBlXCI6IFwib2E6QW5ub3RhdGlvblwiLFxuICAgICAgICAgICAgbW90aXZhdGlvbjogXCJvYTpjb21tZW50aW5nXCIsIC8vIFRPRE86IHVzZSB2M2Fubm8ubW90aXZhdGlvblxuICAgICAgICAgICAgb246IHtcbiAgICAgICAgICAgICAgICBcIkB0eXBlXCI6IFwib2E6U3BlY2lmaWNSZXNvdXJjZVwiLFxuICAgICAgICAgICAgICAgIGZ1bGw6ICh2M2Fubm8udGFyZ2V0LnNvdXJjZSBhcyBTb3VyY2UpLmlkLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlc291cmNlLFxuICAgICAgICB9O1xuICAgICAgICBpZiAodjNhbm5vLnRhcmdldC5zZWxlY3Rvcikge1xuICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodjNhbm5vLnRhcmdldC5zZWxlY3RvcikpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RvcnMgPSB2M2Fubm8udGFyZ2V0LnNlbGVjdG9yLm1hcCgocykgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAocykge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHYyU2VsZWN0b3IgPSB0aGlzLmNyZWF0ZVYyQW5ub1NlbGVjdG9yKHMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHYyU2VsZWN0b3IpIHJldHVybiB2MlNlbGVjdG9yO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgLy8gY3JlYXRlIGNob2ljZSwgYXNzdW1pbmcgdHdvIGVsZW1lbnRzIGFuZCAwIGlzIGRlZmF1bHRcbiAgICAgICAgICAgICAgICB2MmFubm8ub24uc2VsZWN0b3IgPSB7XG4gICAgICAgICAgICAgICAgICAgIFwiQHR5cGVcIjogXCJvYTpDaG9pY2VcIixcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogc2VsZWN0b3JzWzBdLFxuICAgICAgICAgICAgICAgICAgICBpdGVtOiBzZWxlY3RvcnNbMV0sXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbGV0IHYyU2VsZWN0b3IgPSB0aGlzLmNyZWF0ZVYyQW5ub1NlbGVjdG9yKFxuICAgICAgICAgICAgICAgICAgICB2M2Fubm8udGFyZ2V0LnNlbGVjdG9yXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICBpZiAodjJTZWxlY3RvcikgdjJhbm5vLm9uLnNlbGVjdG9yID0gdjJTZWxlY3RvcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICgodjNhbm5vLnRhcmdldC5zb3VyY2UgYXMgU291cmNlKS5wYXJ0T2YpIHtcbiAgICAgICAgICAgICAgICB2MmFubm8ub24ud2l0aGluID0ge1xuICAgICAgICAgICAgICAgICAgICBcIkBpZFwiOiAodjNhbm5vLnRhcmdldC5zb3VyY2UgYXMgU291cmNlKS5wYXJ0T2YuaWQsXG4gICAgICAgICAgICAgICAgICAgIFwiQHR5cGVcIjogXCJzYzpNYW5pZmVzdFwiLFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHYyYW5ubztcbiAgICB9XG5cbiAgICAvKiogKi9cbiAgICBzdGF0aWMgY3JlYXRlVjJBbm5vQm9keSh2M2JvZHk6IFYzQm9keSkge1xuICAgICAgICBjb25zdCB2MmJvZHk6IFYyQm9keSA9IHtcbiAgICAgICAgICAgIFwiQHR5cGVcIjogdjNib2R5LnB1cnBvc2UgPT09IFwidGFnZ2luZ1wiID8gXCJvYTpUYWdcIiA6IFwiZGN0eXBlczpUZXh0XCIsXG4gICAgICAgICAgICBjaGFyczogdjNib2R5LnZhbHVlLFxuICAgICAgICB9O1xuICAgICAgICBpZiAodjNib2R5LmZvcm1hdCkge1xuICAgICAgICAgICAgdjJib2R5LmZvcm1hdCA9IHYzYm9keS5mb3JtYXQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHYzYm9keS5sYW5ndWFnZSkge1xuICAgICAgICAgICAgdjJib2R5Lmxhbmd1YWdlID0gdjNib2R5Lmxhbmd1YWdlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB2MmJvZHk7XG4gICAgfVxuXG4gICAgLyoqICovXG4gICAgc3RhdGljIGNyZWF0ZVYyQW5ub1NlbGVjdG9yKHYzc2VsZWN0b3I6IFYzU2VsZWN0b3IpOiBWMlNlbGVjdG9yIHwgbnVsbCB7XG4gICAgICAgIHN3aXRjaCAodjNzZWxlY3Rvci50eXBlKSB7XG4gICAgICAgICAgICBjYXNlIFwiU3ZnU2VsZWN0b3JcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBcIkB0eXBlXCI6IFwib2E6U3ZnU2VsZWN0b3JcIixcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHYzc2VsZWN0b3IudmFsdWUsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNhc2UgXCJGcmFnbWVudFNlbGVjdG9yXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgXCJAdHlwZVwiOiBcIm9hOkZyYWdtZW50U2VsZWN0b3JcIixcbiAgICAgICAgICAgICAgICAgICAgLy8gU0FTIHVzZXMgbG9jYXRpb24gaW4geHl3aD14LHksdyxoIGZvcm1hdDsgYW5ub3RvcmlvdXMgdXNlcyBwaXhlbDp4LHksdyxoXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiB2M3NlbGVjdG9yLnZhbHVlLnJlcGxhY2UoXCJ4eXdoPXBpeGVsOlwiLCBcInh5d2g9XCIpLFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqIENyZWF0ZXMgYW4gQW5ub3RhdGlvblBhZ2UgZnJvbSBhIGxpc3Qgb2YgVjIgYW5ub3RhdGlvbnMgKi9cbiAgICBjcmVhdGVBbm5vdGF0aW9uUGFnZSh2MmFubm9zOiBWMkFubm90YXRpb25bXSk6IEFubm90YXRpb25QYWdlIHtcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodjJhbm5vcykpIHtcbiAgICAgICAgICAgIGNvbnN0IHYzYW5ub3MgPSB2MmFubm9zLm1hcCgoYSkgPT5cbiAgICAgICAgICAgICAgICBTaW1wbGVBbm5vdGF0aW9uU2VydmVyVjJBZGFwdGVyLmNyZWF0ZVYzQW5ubyhhKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgaWQ6IHRoaXMuYW5ub3RhdGlvblBhZ2VJZCxcbiAgICAgICAgICAgICAgICBpdGVtczogdjNhbm5vcyxcbiAgICAgICAgICAgICAgICB0eXBlOiBcIkFubm90YXRpb25QYWdlXCIsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB2MmFubm9zO1xuICAgIH1cblxuICAgIC8qKiBDcmVhdGVzIGEgVjMgYW5ub3RhdGlvbiBmcm9tIGEgVjIgYW5ub3RhdGlvbiAqL1xuICAgIHN0YXRpYyBjcmVhdGVWM0Fubm8odjJhbm5vOiBWMkFubm90YXRpb24pOiBWM0Fubm90YXRpb24ge1xuICAgICAgICBsZXQgYm9keSA9IG51bGw7XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KHYyYW5uby5yZXNvdXJjZSkpIHtcbiAgICAgICAgICAgIGJvZHkgPSB2MmFubm8ucmVzb3VyY2UubWFwKChiOiBWMkJvZHkpID0+IHRoaXMuY3JlYXRlVjNBbm5vQm9keShiKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBib2R5ID0gdGhpcy5jcmVhdGVWM0Fubm9Cb2R5KHYyYW5uby5yZXNvdXJjZSk7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHYydGFyZ2V0ID0gdjJhbm5vLm9uO1xuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2MnRhcmdldCkpIHtcbiAgICAgICAgICAgIFt2MnRhcmdldF0gPSB2MnRhcmdldDtcbiAgICAgICAgfVxuICAgICAgICBsZXQgdGFyZ2V0OiBUYXJnZXQgPSB7XG4gICAgICAgICAgICBzZWxlY3RvcjogdjJ0YXJnZXQuc2VsZWN0b3IgPyB0aGlzLmNyZWF0ZVYzQW5ub1NlbGVjdG9yKHYydGFyZ2V0LnNlbGVjdG9yKSA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIHNvdXJjZTogdjJ0YXJnZXQuZnVsbCxcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKHYydGFyZ2V0LndpdGhpbikge1xuICAgICAgICAgICAgdGFyZ2V0LnNvdXJjZSA9IHtcbiAgICAgICAgICAgICAgICBpZDogdjJ0YXJnZXQuZnVsbCxcbiAgICAgICAgICAgICAgICBwYXJ0T2Y6IHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IHYydGFyZ2V0LndpdGhpbltcIkBpZFwiXSxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJNYW5pZmVzdFwiLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdHlwZTogXCJDYW52YXNcIixcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIFwiQGNvbnRleHRcIjogXCJodHRwOi8vd3d3LnczLm9yZy9ucy9hbm5vLmpzb25sZFwiLFxuICAgICAgICAgICAgaWQ6IHYyYW5ub1tcIkBpZFwiXSxcbiAgICAgICAgICAgIG1vdGl2YXRpb246IFwiY29tbWVudGluZ1wiLFxuICAgICAgICAgICAgdHlwZTogXCJBbm5vdGF0aW9uXCIsXG4gICAgICAgICAgICB0YXJnZXQsXG4gICAgICAgICAgICBib2R5LFxuICAgICAgICB9O1xuICAgIH1cblxuICAgIC8qKiAqL1xuICAgIHN0YXRpYyBjcmVhdGVWM0Fubm9Cb2R5KHYyYm9keTogVjJCb2R5KTogVjNCb2R5IHtcbiAgICAgICAgY29uc3QgdjNib2R5OiBWM0JvZHkgPSB7XG4gICAgICAgICAgICB0eXBlOiBcIlRleHR1YWxCb2R5XCIsXG4gICAgICAgICAgICB2YWx1ZTogdjJib2R5LmNoYXJzLFxuICAgICAgICB9O1xuICAgICAgICBpZiAodjJib2R5LmZvcm1hdCkge1xuICAgICAgICAgICAgdjNib2R5LmZvcm1hdCA9IHYyYm9keS5mb3JtYXQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHYyYm9keS5sYW5ndWFnZSkge1xuICAgICAgICAgICAgdjNib2R5Lmxhbmd1YWdlID0gdjJib2R5Lmxhbmd1YWdlO1xuICAgICAgICB9XG4gICAgICAgIGlmICh2MmJvZHlbXCJAdHlwZVwiXSA9PT0gXCJvYTpUYWdcIikge1xuICAgICAgICAgICAgdjNib2R5LnB1cnBvc2UgPSBcInRhZ2dpbmdcIjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdjNib2R5O1xuICAgIH1cblxuICAgIC8qKiAqL1xuICAgIHN0YXRpYyBjcmVhdGVWM0Fubm9TZWxlY3Rvcih2MnNlbGVjdG9yOiBWMlNlbGVjdG9yKTogYW55IHtcbiAgICAgICAgLy8gVE9ETzogdHlwZS1zYWZlIHRoaXMgcmV0dXJuIHZhbHVlXG4gICAgICAgIHN3aXRjaCAodjJzZWxlY3RvcltcIkB0eXBlXCJdKSB7XG4gICAgICAgICAgICBjYXNlIFwib2E6U3ZnU2VsZWN0b3JcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIlN2Z1NlbGVjdG9yXCIsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiB2MnNlbGVjdG9yLnZhbHVlLFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICBjYXNlIFwib2E6RnJhZ21lbnRTZWxlY3RvclwiOlxuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiRnJhZ21lbnRTZWxlY3RvclwiLFxuICAgICAgICAgICAgICAgICAgICBjb25mb3Jtc1RvOiBcImh0dHA6Ly93d3cudzMub3JnL1RSL21lZGlhLWZyYWdzL1wiLFxuICAgICAgICAgICAgICAgICAgICAvLyBTQVMgcmV0dXJucyBsb2NhdGlvbiBpbiB4eXdoPXgseSx3LGggZm9ybWF0OyBhbm5vdG9yaW91cyB1c2VzIHBpeGVsOngseSx3LGhcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHYyc2VsZWN0b3IudmFsdWUgPyB2MnNlbGVjdG9yLnZhbHVlLnJlcGxhY2UoXCJ4eXdoPVwiLCBcInh5d2g9cGl4ZWw6XCIpIDogXCJcIixcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgY2FzZSBcIm9hOkNob2ljZVwiOlxuICAgICAgICAgICAgICAgIC8qIGNyZWF0ZSBhbHRlcm5hdGUgc2VsZWN0b3JzICovXG4gICAgICAgICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICAgICAgICAgdjJzZWxlY3Rvci5kZWZhdWx0XG4gICAgICAgICAgICAgICAgICAgICAgICA/IHRoaXMuY3JlYXRlVjNBbm5vU2VsZWN0b3IodjJzZWxlY3Rvci5kZWZhdWx0KVxuICAgICAgICAgICAgICAgICAgICAgICAgOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICB2MnNlbGVjdG9yLml0ZW1cbiAgICAgICAgICAgICAgICAgICAgICAgID8gdGhpcy5jcmVhdGVWM0Fubm9TZWxlY3Rvcih2MnNlbGVjdG9yLml0ZW0pXG4gICAgICAgICAgICAgICAgICAgICAgICA6IG51bGwsXG4gICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICB9XG59XG4iLCJpbXBvcnQgeyBTZXR0aW5ncyB9IGZyb20gXCIuLi90eXBlcy9TZXR0aW5nc1wiO1xuaW1wb3J0IHsgU291cmNlIH0gZnJvbSBcIi4uL3R5cGVzL1YzL1NvdXJjZVwiO1xuXG5jb25zdCBhZGp1c3RUYXJnZXRTb3VyY2UgPSAoc291cmNlOiBTb3VyY2UgfCBzdHJpbmcsIHNldHRpbmdzOiBTZXR0aW5ncyk6IFNvdXJjZSA9PiB7XG4gICAgLy8gYW5ub3RvcmlvdXMgc2V0cyB0aGUgdGFyZ2V0IHNvdXJjZSBhcyBhIHN0cmluZyBpZDtcbiAgICAvLyB3ZSBuZWVkIHRvIHN0cnVjdHVyZSBpdCB0byBhZGQgY2FudmFzL21hbmlmZXN0IGluZm9cbiAgICBpZiAodHlwZW9mIHNvdXJjZSA9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIC8vIGFkZCBtYW5pZmVzdCBpZCB0byBhbm5vdGF0aW9uXG4gICAgICAgIHNvdXJjZSA9IHtcbiAgICAgICAgICAgIC8vIHVzZSB0aGUgY29uZmlndXJlZCB0YXJnZXQgKHNob3VsZCBiZSBjYW52YXMgaWQpXG4gICAgICAgICAgICBpZDogc2V0dGluZ3MudGFyZ2V0LFxuICAgICAgICAgICAgLy8gbGluayB0byBjb250YWluaW5nIG1hbmlmZXN0XG4gICAgICAgICAgICBwYXJ0T2Y6IHtcbiAgICAgICAgICAgICAgICBpZDogc2V0dGluZ3MubWFuaWZlc3QsXG4gICAgICAgICAgICAgICAgdHlwZTogXCJNYW5pZmVzdFwiLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHR5cGU6IFwiQ2FudmFzXCIsXG4gICAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBzb3VyY2U7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGFkanVzdFRhcmdldFNvdXJjZTtcbiIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4iLCIvLyBzdGFydHVwXG4vLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbi8vIFRoaXMgZW50cnkgbW9kdWxlIGlzIHJlZmVyZW5jZWQgYnkgb3RoZXIgbW9kdWxlcyBzbyBpdCBjYW4ndCBiZSBpbmxpbmVkXG52YXIgX193ZWJwYWNrX2V4cG9ydHNfXyA9IF9fd2VicGFja19yZXF1aXJlX18oNjA3KTtcbiJdLCJuYW1lcyI6WyJBbm5vTG9hZEV2ZW50IiwiRXZlbnQiLCJhbm5vIiwic2V0dGluZ3MiLCJhZGFwdGVyIiwidGFyZ2V0IiwiYW5ub3RhdGlvbkVuZHBvaW50IiwiYWxsIiwidGhlbiIsImFubm90YXRpb25QYWdlIiwic2V0QW5ub3RhdGlvbnMiLCJpdGVtcyIsImRvY3VtZW50IiwiZGlzcGF0Y2hFdmVudCIsIm9uIiwiYXN5bmMiLCJhbm5vdGF0aW9uIiwic291cmNlIiwiY3JlYXRlIiwiY29uc29sZSIsImxvZyIsImFkZEFubm90YXRpb24iLCJwcmV2aW91cyIsImlkIiwidXBkYXRlIiwiZGVsZXRlIiwiU2ltcGxlQW5ub3RhdGlvblNlcnZlclYyQWRhcHRlciIsImNvbnN0cnVjdG9yIiwiY2FudmFzSWQiLCJlbmRwb2ludFVybCIsInRoaXMiLCJhbm5vdGF0aW9uUGFnZUlkIiwiZmV0Y2giLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImNyZWF0ZVYyQW5ubyIsImhlYWRlcnMiLCJBY2NlcHQiLCJtZXRob2QiLCJjYXRjaCIsImFubm9JZCIsImVuY29kZVVSSUNvbXBvbmVudCIsImZpbmQiLCJpdGVtIiwicmVzcCIsImFubm9zIiwianNvbiIsImNyZWF0ZUFubm90YXRpb25QYWdlIiwic3RhdGljIiwidjNhbm5vIiwicmVzb3VyY2UiLCJBcnJheSIsImlzQXJyYXkiLCJtYXAiLCJiIiwiY3JlYXRlVjJBbm5vQm9keSIsInYyYW5ubyIsInN0YXJ0c1dpdGgiLCJ1bmRlZmluZWQiLCJtb3RpdmF0aW9uIiwiZnVsbCIsInNlbGVjdG9yIiwic2VsZWN0b3JzIiwicyIsInYyU2VsZWN0b3IiLCJjcmVhdGVWMkFubm9TZWxlY3RvciIsImRlZmF1bHQiLCJwYXJ0T2YiLCJ3aXRoaW4iLCJ2M2JvZHkiLCJ2MmJvZHkiLCJwdXJwb3NlIiwiY2hhcnMiLCJ2YWx1ZSIsImZvcm1hdCIsImxhbmd1YWdlIiwidjNzZWxlY3RvciIsInR5cGUiLCJyZXBsYWNlIiwidjJhbm5vcyIsInYzYW5ub3MiLCJhIiwiY3JlYXRlVjNBbm5vIiwiY3JlYXRlVjNBbm5vQm9keSIsInYydGFyZ2V0IiwiY3JlYXRlVjNBbm5vU2VsZWN0b3IiLCJ2MnNlbGVjdG9yIiwiY29uZm9ybXNUbyIsIm1hbmlmZXN0IiwiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX2V4cG9ydHNfXyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImNhY2hlZE1vZHVsZSIsImV4cG9ydHMiLCJtb2R1bGUiLCJfX3dlYnBhY2tfbW9kdWxlc19fIiwiY2FsbCJdLCJzb3VyY2VSb290IjoiIn0=